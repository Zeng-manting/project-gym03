<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>课程管理 - 健身房管理系统</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f8f9fa;
        }
        .sidebar {
            min-height: 100vh;
            background-color: #2c3e50;
            color: white;
            padding: 1rem;
        }
        .sidebar h4 {
            border-bottom: 1px solid #34495e;
            padding-bottom: 0.5rem;
            margin-bottom: 1rem;
        }
        .sidebar a {
            color: #ecf0f1;
            display: block;
            padding: 0.5rem 1rem;
            margin-bottom: 0.25rem;
            border-radius: 4px;
            text-decoration: none;
            transition: all 0.3s ease;
        }
        .sidebar a:hover,
        .sidebar a.active {
            background-color: #34495e;
            color: #3498db;
        }
        .content {
            padding: 2rem;
        }
        .card {
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 1.5rem;
        }
        .course-form {
            background-color: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        .table-container {
            background-color: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            overflow-x: auto;
        }
        .table thead {
            background-color: #f8f9fa;
        }
        .table th,
        .table td {
            padding: 0.75rem 1rem;
            vertical-align: middle;
        }
        .btn {
            font-size: 0.875rem;
            padding: 0.25rem 0.75rem;
            margin: 0 0.25rem;
        }
        .form-group {
            margin-bottom: 1.5rem;
        }
        .form-label {
            font-weight: 500;
            margin-bottom: 0.5rem;
        }
        .input-group-text {
            background-color: #f8f9fa;
        }
        /* 移除了不需要的样式类 */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-top: 1rem;
        }
        .calendar-day {
            padding: 0.5rem;
            text-align: center;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .calendar-day:hover {
            background-color: #f8f9fa;
        }
        .calendar-day.selected {
            background-color: #3498db;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- 侧边栏 -->
            <div class="col-md-2 sidebar">
                <h4>管理系统</h4>
                <a th:href="@{/admin}">首页</a>
                <a th:href="@{/admin/members}">会员管理</a>
                <a th:href="@{/admin/coaches}">教练管理</a>
                <a th:href="@{/admin/courses}" class="active">课程管理</a>
                <a th:href="@{/admin/cards}">会员卡设置</a>
                <a th:href="@{/logout}">退出登录</a>
            </div>

            <!-- 主内容区 -->
            <div class="col-md-10 content">
                <h2 class="mb-4">课程管理</h2>

                <!-- 课程添加表单 -->
                <div class="course-form mb-4">
                    <h4 class="mb-3">添加课程</h4>
                    <form id="courseForm">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="courseName" class="form-label">课程名称</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fa fa-book"></i></span>
                                    <input type="text" class="form-control" id="courseName" placeholder="请输入课程名称" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label for="courseCoach" class="form-label">授课教练</label>
                                <select class="form-select" id="courseCoach" required>
                                    <option value="">请选择教练</option>
                                    <option th:each="trainer : ${trainers}" 
                                            th:value="${trainer.id}" 
                                            th:text="${trainer.name != null ? trainer.name : '未设置姓名'} + ' - ' + (trainer.gender != null ? trainer.gender : '未知性别')">
                                        教练姓名
                                    </option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="courseCapacity" class="form-label">最大容量</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fa fa-users"></i></span>
                                    <input type="number" class="form-control" id="courseCapacity" min="1" max="50" placeholder="请输入最大容量" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label for="courseDate" class="form-label">课程日期</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fa fa-calendar"></i></span>
                                    <input type="date" class="form-control" id="courseDate" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label for="courseTime" class="form-label">课程时间</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fa fa-clock-o"></i></span>
                                    <input type="time" class="form-control" id="courseTime" required>
                                </div>
                            </div>
                            <div class="col-md-12">
                                <button type="button" class="btn btn-primary" onclick="saveCourse()">
                                    <i class="fa fa-save"></i> 保存课程信息
                                </button>
                                <button type="button" class="btn btn-outline-secondary" onclick="resetForm()">
                                    <i class="fa fa-refresh"></i> 重置
                                </button>
                            </div>
                        </div>
                    </form>
                </div>

                <!-- 课程列表 -->
                <div class="table-container">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h4>课程列表</h4>
                        <div class="input-group" style="width: 300px;">
                            <input type="text" class="form-control" id="searchCourse" placeholder="搜索课程名称或教练">
                            <button class="btn btn-primary" onclick="searchCourses()">
                                <i class="fa fa-search"></i>
                            </button>
                        </div>
                    </div>
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>课程名称</th>
                                <th>授课教练</th>
                                <th>上课时间</th>
                                <th>当前人数/最大容量</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="courseTableBody">
                            <!-- 使用Thymeleaf循环展示动态课程数据 -->
                            <tr th:each="course : ${courses}">
                                <td th:text="${course.name}">课程名称</td>
                                <td>
                                    <!-- 查找对应的教练信息 -->
                                    <span th:each="trainer : ${trainers}" 
                                          th:if="${trainer.id == course.trainerId}" 
                                          th:text="${trainer.name != null ? trainer.name : '未知教练'}">
                                        教练姓名
                                    </span>
                                </td>
                                <td th:text="${course.scheduleTime != null ? course.scheduleTime : 'Not Scheduled'}">上课时间</td>
                                <td th:text="${course.currentCount} + '/' + ${course.maxCapacity}">0/20</td>
                                <td>
                                    <button class="btn btn-info" th:attr="onclick='viewCourse(' + ${course.id} + ')'">
                                        <i class="fa fa-eye"></i>
                                    </button>
                                    <button class="btn btn-warning" th:attr="onclick='editCourse(' + ${course.id} + ')'">
                                        <i class="fa fa-edit"></i>
                                    </button>
                                    <button class="btn btn-danger" th:attr="onclick='deleteCourse(' + ${course.id} + ')'">
                                        <i class="fa fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                            <!-- 当没有课程时显示空状态 -->
                            <tr th:if="${courses.empty}">
                                <td colspan="5" class="text-center">暂无课程数据</td>
                            </tr>
                        </tbody>
                    </table>

                    <!-- 分页控件 -->
                    <div class="d-flex justify-content-between align-items-center mt-3">
                        <div class="text-muted">显示 1-6 条，共 6 条</div>
                        <nav aria-label="Page navigation">
                            <ul class="pagination">
                                <li class="page-item disabled"><a class="page-link" href="#">上一页</a></li>
                                <li class="page-item active"><a class="page-link" href="#">1</a></li>
                                <li class="page-item disabled"><a class="page-link" href="#">下一页</a></li>
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 课程详情模态框 -->
    <div class="modal fade" id="courseDetailModal" tabindex="-1" aria-labelledby="courseDetailModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="courseDetailModalLabel">课程详情</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="courseDetailContent">
                    <!-- 课程详情内容将通过JavaScript动态填充 -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 日历选课模态框 -->
    <div class="modal fade" id="calendarModal" tabindex="-1" aria-labelledby="calendarModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="calendarModalLabel">课程日历</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <button class="btn btn-outline-secondary" onclick="changeMonth(-1)"><i class="fa fa-chevron-left"></i></button>
                        <h6 id="currentMonth"></h6>
                        <button class="btn btn-outline-secondary" onclick="changeMonth(1)"><i class="fa fa-chevron-right"></i></button>
                    </div>
                    <div class="calendar-grid" id="calendarDays">
                        <!-- 日历将通过JavaScript动态生成 -->
                    </div>
                    <div id="selectedDateCourses" class="mt-4">
                        <h6>当天课程</h6>
                        <div class="list-group">
                            <!-- 当天课程将通过JavaScript动态生成 -->
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 初始化模态框
        const courseDetailModal = new bootstrap.Modal(document.getElementById('courseDetailModal'));
        const calendarModal = new bootstrap.Modal(document.getElementById('calendarModal'));
        
        // 当前日期用于日历显示
        let currentDate = new Date();

        // 保存课程信息
        function saveCourse() {
            // 验证表单
            if (!validateForm()) {
                alert('请填写必填字段并确保格式正确');
                return;
            }

            // 获取表单数据
            const courseData = {
                name: document.getElementById('courseName').value,
                trainerId: document.getElementById('courseCoach').value,
                maxCapacity: document.getElementById('courseCapacity').value,
                scheduleTime: document.getElementById('courseDate').value + ' ' + document.getElementById('courseTime').value
            };

            // 这里可以通过AJAX请求保存数据
            console.log('保存课程信息:', courseData);
            
            // 模拟保存成功
            alert('课程信息保存成功！');
            resetForm();
        }

        // 重置表单
        function resetForm() {
            document.getElementById('courseForm').reset();
        }

        // 表单验证
        function validateForm() {
            const name = document.getElementById('courseName').value;
            const coach = document.getElementById('courseCoach').value;
            const capacity = document.getElementById('courseCapacity').value;
            const date = document.getElementById('courseDate').value;
            const time = document.getElementById('courseTime').value;

            // 简单验证
            if (!name || !coach || !capacity || !date || !time) {
                return false;
            }

            return true;
        }

        // 搜索课程
        function searchCourses() {
            const keyword = document.getElementById('searchCourse').value;
            console.log('搜索课程:', keyword);
            alert(`搜索关键词: ${keyword}`);
        }

        // 查看课程详情
        function viewCourse(id) {
            console.log('查看课程详情:', id);
            
            // 根据ID获取实际课程数据
            const courseDetails = getCourseById(id);
            
            // 构建详情HTML
            const detailHTML = `
                <div class="row">
                    <div class="col-md-12">
                        <h4>${courseDetails.name}</h4>
                        <p><strong>授课教练：</strong>${courseDetails.coachName || courseDetails.coach || '-'}</p>
                        <p><strong>上课时间：</strong>${courseDetails.scheduleTime}</p>
                        <p><strong>报名情况：</strong>${courseDetails.currentCount}/${courseDetails.maxCapacity}</p>
                        <p><strong>创建时间：</strong>${courseDetails.createdAt}</p>
                    </div>
                </div>
            `;

            // 填充详情内容
            document.getElementById('courseDetailContent').innerHTML = detailHTML;
            
            // 显示模态框
            courseDetailModal.show();
        }
        
        // 根据ID获取课程信息
        function getCourseById(id) {
            // 模拟从后端API获取课程数据
            // 在实际应用中，这里应该是一个异步请求
            // 这里保持基本结构，但移除硬编码的教练姓名
            // 教练信息应该由后端提供
            const courses = [
                {
                    id: 1,
                    name: '拳击入门课',
                    trainerId: 2, // 对应教练ID
                    coachName: '王强', // 实际教练姓名
                    scheduleTime: '2025-12-23 15:54:20',
                    maxCapacity: 20,
                    currentCount: 0,
                    createdAt: '2025-11-11 08:56:43',
                    updatedAt: '2025-11-25 23:20:01'
                },
                {
                    id: 2,
                    name: '游泳技能提升课',
                    trainerId: 2,
                    coachName: '王强',
                    scheduleTime: '2025-12-24 15:54:20',
                    maxCapacity: 15,
                    currentCount: 0,
                    createdAt: '2025-11-11 08:56:43',
                    updatedAt: '2025-11-25 23:20:01'
                },
                {
                    id: 3,
                    name: '燃脂HIIT',
                    trainerId: 3,
                    coachName: '张敏', // 分配给另一位教练
                    scheduleTime: '2025-12-25 15:54:20',
                    maxCapacity: 25,
                    currentCount: 0,
                    createdAt: '2025-11-11 08:56:43',
                    updatedAt: '2025-11-25 23:20:01'
                },
                {
                    id: 7,
                    name: '芭蕾课',
                    trainerId: 3,
                    coachName: '张敏', // 更适合女性教练
                    scheduleTime: '2025-12-26 15:54:20',
                    maxCapacity: 15,
                    currentCount: 1,
                    createdAt: '2025-11-22 15:54:20',
                    updatedAt: '2025-11-25 23:20:02'
                },
                {
                    id: 8,
                    name: '核心力量训练',
                    trainerId: 4,
                    coachName: '李刚', // 分配给第三位教练
                    scheduleTime: '2025-12-27 15:54:20',
                    maxCapacity: 20,
                    currentCount: 1,
                    createdAt: '2025-11-22 15:54:20',
                    updatedAt: '2025-11-25 23:20:02'
                },
                {
                    id: 9,
                    name: '体态矫正私教',
                    trainerId: 4,
                    coachName: '李刚',
                    scheduleTime: '2025-12-29 15:54:20',
                    maxCapacity: 12,
                    currentCount: 0,
                    createdAt: '2025-11-22 15:54:20',
                    updatedAt: '2025-11-25 23:20:02'
                }
            ];
            
            return courses.find(course => course.id === id) || {
                id: id,
                name: '未找到课程',
                trainerId: null,
                coachName: '-',
                scheduleTime: '-',
                maxCapacity: 0,
                currentCount: 0,
                createdAt: '-',
                updatedAt: '-'
            };
        }

        // 编辑课程
        function editCourse(id) {
            console.log('编辑课程:', id);
            
            // 获取课程信息并填充表单
            const course = getCourseById(id);
            const [date, time] = course.scheduleTime.split(' ');
            
            document.getElementById('courseName').value = course.name;
            // 使用trainerId而不是基于姓名的判断
            document.getElementById('courseCoach').value = course.trainerId || 
                                                          (course.coach === '王强' ? '2' : 
                                                          (course.coach === '张敏' ? '3' : '4'));
            document.getElementById('courseCapacity').value = course.maxCapacity;
            document.getElementById('courseDate').value = date;
            document.getElementById('courseTime').value = time;
            
            // 滚动到表单顶部
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // 删除课程
        function deleteCourse(id) {
            if (confirm(`确定要删除ID为${id}的课程吗？`)) {
                console.log('删除课程:', id);
                alert(`课程ID: ${id} 已删除`);
                // 这里可以通过AJAX请求删除课程
            }
        }

        // 初始化日历
        function initCalendar() {
            renderCalendar();
        }

        // 渲染日历
        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            // 更新当前月份显示
            const monthNames = ['一月', '二月', '三月', '四月', '五月', '六月', '七月', '八月', '九月', '十月', '十一月', '十二月'];
            document.getElementById('currentMonth').textContent = `${year}年 ${monthNames[month]}`;
            
            // 清空日历
            const calendarDays = document.getElementById('calendarDays');
            calendarDays.innerHTML = '';
            
            // 添加星期标题
            const weekdays = ['日', '一', '二', '三', '四', '五', '六'];
            weekdays.forEach(day => {
                const weekdayElement = document.createElement('div');
                weekdayElement.className = 'calendar-day text-center font-weight-bold';
                weekdayElement.textContent = day;
                calendarDays.appendChild(weekdayElement);
            });
            
            // 获取当月第一天
            const firstDay = new Date(year, month, 1);
            // 获取当月最后一天
            const lastDay = new Date(year, month + 1, 0);
            // 获取当月第一天是星期几
            const startingDayOfWeek = firstDay.getDay();
            // 获取当月天数
            const daysInMonth = lastDay.getDate();
            
            // 添加空白单元格
            for (let i = 0; i < startingDayOfWeek; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day';
                calendarDays.appendChild(emptyDay);
            }
            
            // 添加日期单元格
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = day;
                
                // 随机添加一些课程标记
                if (Math.random() > 0.5) {
                    dayElement.style.backgroundColor = '#e3f2fd';
                    dayElement.title = '有课程安排';
                }
                
                dayElement.addEventListener('click', () => {
                    // 移除其他选中状态
                    document.querySelectorAll('.calendar-day.selected').forEach(el => {
                        el.classList.remove('selected');
                    });
                    // 添加选中状态
                    dayElement.classList.add('selected');
                    // 显示当天课程
                    showDayCourses(year, month + 1, day);
                });
                
                calendarDays.appendChild(dayElement);
            }
        }

        // 显示指定日期的课程
        function showDayCourses(year, month, day) {
            const formattedDate = `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
            const coursesList = document.querySelector('#selectedDateCourses .list-group');
            
            // 模拟当天课程数据，使用系统中实际的教练信息
            // 实际应用中，应该从后端获取真实数据
            const courses = [
                { id: 1, name: '力量训练基础', time: '19:00', trainerId: 2, coachName: '王强' },
                { id: 2, name: '瑜伽放松课', time: '20:30', trainerId: 3, coachName: '张敏' }
            ];
            
            // 清空课程列表
            coursesList.innerHTML = '';
            
            if (courses.length === 0) {
                const noCourseItem = document.createElement('div');
                noCourseItem.className = 'list-group-item text-muted';
                noCourseItem.textContent = '当天没有课程安排';
                coursesList.appendChild(noCourseItem);
            } else {
                courses.forEach(course => {
                    const courseItem = document.createElement('div');
                    courseItem.className = 'list-group-item list-group-item-action';
                    courseItem.innerHTML = `
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="mb-0">${course.name}</h6>
                                <small class="text-muted">${course.coachName || course.coach || '-'}</small>
                            </div>
                            <span class="badge bg-primary">${course.time}</span>
                        </div>
                    `;
                    courseItem.addEventListener('click', () => viewCourse(course.id));
                    coursesList.appendChild(courseItem);
                });
            }
        }

        // 切换月份
        function changeMonth(delta) {
            currentDate.setMonth(currentDate.getMonth() + delta);
            renderCalendar();
        }

        // 页面加载时初始化日历
        window.addEventListener('DOMContentLoaded', () => {
            initCalendar();
        });
    </script>
</body>
</html>