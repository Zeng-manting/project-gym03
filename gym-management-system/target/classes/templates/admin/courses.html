<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>课程管理 - 健身房管理系统</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="/css/admin.css">
    <style>
        /* 自定义样式 - 与会员管理页面风格一致 */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f8f9fa;
        }
        .sidebar {
            min-height: 100vh;
            background-color: #2c3e50;
            color: white;
            padding: 1rem;
        }
        .sidebar h4 {
            border-bottom: 1px solid #34495e;
            padding-bottom: 0.5rem;
            margin-bottom: 1rem;
        }
        .sidebar a {
            color: #ecf0f1;
            display: block;
            padding: 0.5rem 1rem;
            margin-bottom: 0.25rem;
            border-radius: 4px;
            text-decoration: none;
            transition: all 0.3s ease;
        }
        .sidebar a:hover,
        .sidebar a.active {
            background-color: #34495e;
            color: #3498db;
        }
        .content {
            padding: 2rem;
        }
        .nav-link.active {
            background-color: #495057;
            border-left: 4px solid #007bff;
        }
        
        /* 搜索区域样式 */
        .search-container {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        /* 表格样式 */
        .table-container {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .table-hover tbody tr:hover {
            background-color: #f8f9fa;
        }
        .table thead {
            background-color: #f8f9fa;
        }
        .table th,
        .table td {
            padding: 0.75rem 1rem;
            vertical-align: middle;
        }
        
        /* 操作按钮组样式 */
        .btn-group .btn {
            margin-right: 2px;
            margin-left: 2px;
            transition: all 0.3s ease;
        }
        .btn-group .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 6px rgba(0,0,0,0.15);
        }
        
        /* 模态框样式增强 */
        .modal-header {
            border-bottom: none;
            padding: 15px 20px;
        }
        .modal-footer {
            border-top: 1px solid #dee2e6;
            padding: 15px 20px;
        }
        .form-group {
            margin-bottom: 1rem;
        }
        .form-label {
            font-weight: 500;
            margin-bottom: 5px;
        }
        .input-group-text {
            background-color: #f8f9fa;
        }
        
        /* 日历样式 */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-top: 1rem;
        }
        .calendar-day {
            height: 80px;
            min-width: 80px;
            border: 1px solid #ddd;
            padding: 5px;
            margin: 5px;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.2s ease;
            text-align: center;
        }
        .calendar-day:hover {
            background-color: #f8f9fa;
            transform: translateY(-1px);
        }
        .calendar-day.selected {
            background-color: #3498db;
            color: white;
        }
        .calendar-day.has-event {
            background-color: #e3f2fd;
        }
        .calendar-day .date {
            font-weight: bold;
        }
        .calendar-day .events {
            font-size: 12px;
            margin-top: 5px;
            color: #666;
        }
        
        /* 导航和按钮通用样式 */
        .nav-link:hover {
            background-color: #495057;
        }
        .btn {
            border-radius: 4px;
            transition: all 0.3s ease;
            font-size: 0.875rem;
            padding: 0.25rem 0.75rem;
            margin: 0 0.25rem;
        }
        .btn i {
            margin-right: 5px;
        }
        
        /* 状态标签样式 */
        .badge {
            font-size: 0.75rem;
            padding: 0.4rem 0.6rem;
            border-radius: 4px;
        }
        
        /* 课程表单样式 */
        .course-form {
            background-color: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        /* 响应式调整 */
        @media (max-width: 768px) {
            .content {
                margin-left: 0;
            }
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
            }
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- 侧边栏 -->
            <div class="col-md-2 sidebar">
                <h4>管理系统</h4>
                <a th:href="@{/admin}">首页</a>
                <a th:href="@{/admin/members}">会员管理</a>
                <a th:href="@{/admin/coaches}">教练管理</a>
                <a th:href="@{/admin/courses}" class="active">课程管理</a>
                <a th:href="@{/admin/cards}">会员卡设置</a>
                <a th:href="@{/logout}">退出登录</a>
            </div>

            <!-- 主内容区 -->
            <div class="col-md-10 content">
                <h2 class="mb-4">课程管理</h2>

                <!-- 课程添加表单 -->
                <div class="course-form mb-4">
                    <h4 class="mb-3">添加课程</h4>
                    <form id="courseForm">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="courseName" class="form-label">课程名称</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fa fa-book"></i></span>
                                    <input type="text" class="form-control" id="courseName" placeholder="请输入课程名称" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label for="courseCoach" class="form-label">授课教练</label>
                                <select class="form-select" id="courseCoach" required>
                                    <option value="">请选择教练</option>
                                    <option th:each="trainer : ${trainers}" 
                                            th:value="${trainer.id}" 
                                            th:text="${trainer.name != null ? trainer.name : '未设置姓名'} + ' - ' + (trainer.gender != null ? trainer.gender : '未知性别')">
                                        教练姓名
                                    </option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="courseCapacity" class="form-label">最大容量</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fa fa-users"></i></span>
                                    <input type="number" class="form-control" id="courseCapacity" min="1" max="50" placeholder="请输入最大容量" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label for="courseDate" class="form-label">课程日期</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fa fa-calendar"></i></span>
                                    <input type="date" class="form-control" id="courseDate" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label for="courseTime" class="form-label">课程时间</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fa fa-clock-o"></i></span>
                                    <input type="time" class="form-control" id="courseTime" required>
                                </div>
                            </div>
                            <div class="col-md-12">
                                <button type="button" class="btn btn-primary" onclick="saveCourse()">
                                    <i class="fa fa-save"></i> 保存课程信息
                                </button>
                                <button type="button" class="btn btn-outline-secondary" onclick="resetForm()">
                                    <i class="fa fa-refresh"></i> 重置
                                </button>
                            </div>
                        </div>
                    </form>
                </div>

                <!-- 搜索区域 -->
                <div class="search-container">
                    <div class="row g-3">
                        <div class="col-md-3">
                            <label for="searchCourseName" class="form-label">课程名称</label>
                            <input type="text" class="form-control" id="searchCourseName" placeholder="请输入课程名称">
                        </div>
                        <div class="col-md-3">
                            <label for="searchCoach" class="form-label">授课教练</label>
                            <select class="form-select" id="searchCoach">
                                <option value="">全部</option>
                                <option th:each="trainer : ${trainers}" 
                                        th:value="${trainer.id}" 
                                        th:text="${trainer.name != null ? trainer.name : '未设置姓名'}">
                                    教练姓名
                                </option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label for="searchDate" class="form-label">课程日期</label>
                            <input type="date" class="form-control" id="searchDate">
                        </div>
                        <div class="col-md-3">
                            <label for="searchStatus" class="form-label">状态</label>
                            <select class="form-select" id="searchStatus">
                                <option value="">全部</option>
                                <option value="upcoming">即将开始</option>
                                <option value="ongoing">进行中</option>
                                <option value="completed">已完成</option>
                            </select>
                        </div>
                        <div class="col-md-12 text-center">
                            <button class="btn btn-primary" onclick="searchCourses()">
                                <i class="fa fa-search"></i> 搜索
                            </button>
                            <button class="btn btn-outline-secondary" onclick="resetSearch()">
                                <i class="fa fa-refresh"></i> 重置
                            </button>
                            <button class="btn btn-success" onclick="addCourse()">
                                <i class="fa fa-plus"></i> 新增课程
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 课程列表 -->
                <div class="table-container">
                    <h4 class="mb-3">课程列表</h4>
                    <table id="coursesTable" class="table table-striped table-hover">
                        <thead class="bg-primary text-white">
                        <tr>
                            <th>序号</th>
                            <th>课程ID</th>
                            <th>课程名称</th>
                            <th>授课教练</th>
                                <th>上课时间</th>
                                <th>人数情况</th>
                            <th>操作</th>
                        </tr>
                        </thead>
                        <tbody id="courseTableBody">
                        <!-- 使用Thymeleaf循环展示动态课程数据 -->
                        <tr th:each="course, stat : ${courses}">
                            <td th:text="${stat.count}">1</td>
                            <td th:text="${course.id}">1</td>
                            <td th:text="${course.name}">课程名称</td>
                            <td>
                                    <!-- 查找对应的教练信息，并隐藏教练ID -->
                                    <span th:each="trainer : ${trainers}" 
                                          th:if="${trainer.id == course.trainerId}">
                                        <span th:text="${trainer.name != null ? trainer.name : '未知教练'}">教练姓名</span>
                                        <span class="d-none trainer-id" th:text="${trainer.id}"></span>
                                    </span>
                                </td>
                                <td th:text="${course.scheduleTime != null ? course.scheduleTime : 'Not Scheduled'}">上课时间</td>
                                <td th:text="${course.currentCount} + '/' + ${course.maxCapacity}">0/20</td>
                                <td>
                                    <div class="btn-group" role="group" aria-label="课程操作">
                                        <button type="button" class="btn btn-sm btn-info" th:onclick="'viewCourse(' + ${course.id} + ')'" title="查看详情">
                                            <i class="fa fa-eye"></i>
                                        </button>
                                        <button type="button" class="btn btn-sm btn-warning" th:onclick="'editCourse(' + ${course.id} + ')'" title="编辑">
                                            <i class="fa fa-pencil"></i>
                                        </button>
                                        <button type="button" class="btn btn-sm btn-danger" th:onclick="'deleteCourse(' + ${course.id} + ')'" title="删除">
                                            <i class="fa fa-trash"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            <!-- 当没有课程时显示空状态 -->
                            <tr th:if="${courses.empty}">
                                <td colspan="5" class="text-center">暂无课程数据</td>
                            </tr>
                        </tbody>
                    </table>

                    <!-- 分页控件 -->
                    <div class="d-flex justify-content-between align-items-center mt-3">
                        <div class="text-muted">显示 1-6 条，共 6 条</div>
                        <nav aria-label="Page navigation">
                            <ul class="pagination">
                                <li class="page-item disabled"><a class="page-link" href="#">上一页</a></li>
                                <li class="page-item active"><a class="page-link" href="#">1</a></li>
                                <li class="page-item disabled"><a class="page-link" href="#">下一页</a></li>
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 课程详情模态框 -->
        <div class="modal fade" id="courseDetailModal" tabindex="-1" aria-labelledby="courseDetailModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header bg-primary text-white">
                        <h5 class="modal-title" id="courseDetailModalLabel">
                            <i class="fa fa-info-circle"></i> 课程详情
                        </h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="row g-4">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label text-muted">课程ID</label>
                                    <p id="detailCourseId" class="form-control-plaintext font-weight-medium"></p>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label text-muted">课程名称</label>
                                    <p id="detailCourseName" class="form-control-plaintext font-weight-medium"></p>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label text-muted">授课教练</label>
                                    <p id="detailCourseCoach" class="form-control-plaintext font-weight-medium"></p>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label text-muted">上课时间</label>
                                    <p id="detailCourseScheduleTime" class="form-control-plaintext font-weight-medium"></p>
                                </div>
                            </div>
                            <div class="col-md-6">

                                <div class="mb-3">
                                    <label class="form-label text-muted">创建时间</label>
                                    <p id="detailCourseCreatedAt" class="form-control-plaintext font-weight-medium"></p>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label text-muted">课程状态</label>
                                    <p id="detailCourseStatus" class="form-control-plaintext font-weight-medium"></p>
                                </div>
                            </div>
                        </div>
                        <div class="mt-4">
                            <label class="form-label text-muted">人数情况</label>
                            <p id="detailCourseCapacity" class="form-control-plaintext font-weight-medium"></p>
                        </div>
                        <div class="mt-3">
                            <label class="form-label text-muted">备注信息</label>
                            <p id="detailCourseRemark" class="form-control-plaintext font-weight-medium text-gray-600">暂无备注</p>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                            <i class="fa fa-times"></i> 关闭
                        </button>
                    </div>
                </div>
            </div>
        </div>

    <!-- 添加课程模态框 -->
    <div class="modal fade" id="addCourseModal" tabindex="-1" aria-labelledby="addCourseModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="addCourseModalLabel">
                        <i class="fa fa-plus-circle"></i> 添加新课程
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addCourseForm" method="post" th:action="@{/admin/courses/add}">
                        <div class="row g-4">
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label for="courseName" class="form-label">课程名称 <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="courseName" name="name" placeholder="请输入课程名称" required>
                                </div>
                                <div class="form-group mb-3">
                                    <label for="courseTrainer" class="form-label">授课教练 <span class="text-danger">*</span></label>
                                    <select class="form-select" id="courseTrainer" name="trainerId" required>
                                        <option value="">请选择教练</option>
                                        <option th:each="trainer : ${trainers}" 
                                                th:value="${trainer.id}" 
                                                th:text="${trainer.name != null ? trainer.name : '未设置姓名'}">
                                            教练姓名
                                        </option>
                                    </select>
                                </div>

                            </div>
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label for="courseTime" class="form-label">上课时间 <span class="text-danger">*</span></label>
                                    <input type="datetime-local" class="form-control" id="courseTime" name="startTime" required>
                                </div>

                                <div class="form-group mb-3">
                                    <label for="courseCapacity" class="form-label">最大容量 <span class="text-danger">*</span></label>
                                    <input type="number" class="form-control" id="courseCapacity" name="maxCapacity" min="1" max="50" placeholder="请输入最大容量" required>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                        <i class="fa fa-times"></i> 取消
                    </button>
                    <button type="submit" form="addCourseForm" class="btn btn-primary">
                        <i class="fa fa-check"></i> 保存
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 编辑课程模态框 -->
    <div class="modal fade" id="editCourseModal" tabindex="-1" aria-labelledby="editCourseModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="editCourseModalLabel">
                        <i class="fa fa-pencil"></i> 编辑课程
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editCourseForm" method="post" th:action="@{/admin/courses/edit}">
                        <input type="hidden" id="editCourseId" name="id">
                        <div class="row g-4">
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label for="editCourseName" class="form-label">课程名称 <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="editCourseName" name="name" placeholder="请输入课程名称" required>
                                </div>
                                <div class="form-group mb-3">
                                    <label for="editCourseTrainer" class="form-label">授课教练 <span class="text-danger">*</span></label>
                                    <select class="form-select" id="editCourseTrainer" name="trainerId" required>
                                        <option value="">请选择教练</option>
                                        <option th:each="trainer : ${trainers}" 
                                                th:value="${trainer.id}" 
                                                th:text="${trainer.name != null ? trainer.name : '未设置姓名'}">
                                            教练姓名
                                        </option>
                                    </select>
                                </div>

                            </div>
                            <div class="col-md-6">
                                <div class="form-group mb-3">
                                    <label for="editCourseTime" class="form-label">上课时间 <span class="text-danger">*</span></label>
                                    <input type="datetime-local" class="form-control" id="editCourseTime" name="startTime" required>
                                </div>

                                <div class="form-group mb-3">
                                    <label for="editCourseCapacity" class="form-label">最大容量 <span class="text-danger">*</span></label>
                                    <input type="number" class="form-control" id="editCourseCapacity" name="maxCapacity" min="1" max="50" placeholder="请输入最大容量" required>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                        <i class="fa fa-times"></i> 取消
                    </button>
                    <button type="submit" form="editCourseForm" class="btn btn-primary">
                        <i class="fa fa-check"></i> 保存
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 删除确认模态框 -->
    <div class="modal fade" id="deleteCourseModal" tabindex="-1" aria-labelledby="deleteCourseModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title" id="deleteCourseModalLabel">
                        <i class="fa fa-exclamation-triangle"></i> 确认删除
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-warning">
                        <i class="fa fa-warning"></i> 确定要删除课程 <span id="deleteCourseName" class="font-bold text-danger"></span> 吗？
                    </div>
                    <p class="text-muted">此操作不可撤销，删除后相关数据将无法恢复。</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                        <i class="fa fa-times"></i> 取消
                    </button>
                    <button type="button" class="btn btn-danger" id="confirmDelete">
                        <i class="fa fa-trash"></i> 确认删除
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 日历选课模态框 -->
    <div class="modal fade" id="calendarModal" tabindex="-1" aria-labelledby="calendarModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="calendarModalLabel">课程日历</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <button class="btn btn-outline-secondary" onclick="changeMonth(-1)"><i class="fa fa-chevron-left"></i></button>
                        <h6 id="currentMonth"></h6>
                        <button class="btn btn-outline-secondary" onclick="changeMonth(1)"><i class="fa fa-chevron-right"></i></button>
                    </div>
                    <div class="calendar-grid" id="calendarDays">
                        <!-- 日历将通过JavaScript动态生成 -->
                    </div>
                    <div id="selectedDateCourses" class="mt-4">
                        <h6>当天课程</h6>
                        <div class="list-group">
                            <!-- 当天课程将通过JavaScript动态生成 -->
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 初始化模态框
        const courseDetailModal = new bootstrap.Modal(document.getElementById('courseDetailModal'));
        const calendarModal = new bootstrap.Modal(document.getElementById('calendarModal'));
        // 初始化模态框
        const addCourseModal = new bootstrap.Modal(document.getElementById('addCourseModal'));
        const editCourseModal = new bootstrap.Modal(document.getElementById('editCourseModal'));
        const deleteCourseModal = new bootstrap.Modal(document.getElementById('deleteCourseModal'));
        let currentDeleteCourseId = null;
        
        // 当前日期用于日历显示
        let currentDate = new Date();

        // 保存课程信息
        function saveCourse() {
            // 验证表单
            if (!validateForm()) {
                alert('请填写必填字段并确保格式正确');
                return;
            }

            // 获取表单数据
            const courseData = {
                name: document.getElementById('courseName').value,
                trainerId: document.getElementById('courseCoach').value,
                maxCapacity: document.getElementById('courseCapacity').value,
                scheduleTime: document.getElementById('courseDate').value + ' ' + document.getElementById('courseTime').value
            };

            // 这里可以通过AJAX请求保存数据
            console.log('保存课程信息:', courseData);
            
            // 模拟保存成功
            alert('课程信息保存成功！');
            resetForm();
        }

        // 重置表单
        function resetForm() {
            document.getElementById('courseForm').reset();
        }

        // 表单验证
        function validateForm() {
            const name = document.getElementById('courseName').value;
            const coach = document.getElementById('courseCoach').value;
            const capacity = document.getElementById('courseCapacity').value;
            const date = document.getElementById('courseDate').value;
            const time = document.getElementById('courseTime').value;

            // 简单验证
            if (!name || !coach || !capacity || !date || !time) {
                return false;
            }

            return true;
        }

        // 搜索课程
        function searchCourses() {
            const courseName = document.getElementById('searchCourseName').value.trim();
            const coachId = document.getElementById('searchCoach').value;
            const date = document.getElementById('searchDate').value;
            const status = document.getElementById('searchStatus').value;
            console.log('搜索条件:', {courseName, coachId, date, status});
            
            // 在实际应用中，这里应该发送API请求到后端
            // 模拟搜索，过滤表格中的课程数据
            const rows = document.querySelectorAll('#courseTableBody tr');
            rows.forEach(row => {
                // 获取行中的课程信息（实际应用中可能需要更复杂的选择器或数据属性）
                const nameCell = row.querySelector('td:nth-child(3)');
                const coachCell = row.querySelector('td:nth-child(4)');
                const timeCell = row.querySelector('td:nth-child(5)');
                
                let match = true;
                
                // 按课程名称筛选
                if (courseName && nameCell && !nameCell.textContent.toLowerCase().includes(courseName.toLowerCase())) {
                    match = false;
                }
                
                // 按日期筛选
                if (date && timeCell && timeCell.textContent && !timeCell.textContent.includes(date)) {
                    match = false;
                }
                
                row.style.display = match ? '' : 'none';
            });
        }
        
        // 重置搜索
        function resetSearch() {
            document.getElementById('searchCourseName').value = '';
            document.getElementById('searchCoach').value = '';
            document.getElementById('searchDate').value = '';
            document.getElementById('searchStatus').value = '';
            console.log('重置搜索条件');
            
            // 显示所有课程
            const rows = document.querySelectorAll('#courseTableBody tr');
            rows.forEach(row => {
                row.style.display = '';
            });
        }

        // 添加课程
        function addCourse() {
            // 清空表单
            document.getElementById('addCourseForm').reset();
            addCourseModal.show();
        }
        
        // 查看课程详情
        function viewCourse(id) {
            console.log('查看课程详情:', id);
            showCourseDetail(id);
        }
        
        // 显示课程详情（内部使用）
        function showCourseDetail(id) {
            // 根据ID获取实际课程数据
            const courseDetails = getCourseById(id);
            
            // 填充详情字段
            document.getElementById('detailCourseId').textContent = courseDetails.id;
            document.getElementById('detailCourseName').textContent = courseDetails.name;
            document.getElementById('detailCourseCoach').textContent = courseDetails.coachName || courseDetails.coach || '-';
            document.getElementById('detailCourseScheduleTime').textContent = courseDetails.scheduleTime || '-';
            document.getElementById('detailCourseCreatedAt').textContent = courseDetails.createdAt || '-';
            
            // 设置状态显示
            const statusElement = document.getElementById('detailCourseStatus');
            // 根据当前日期判断状态
            const now = new Date();
            const courseTime = new Date(courseDetails.scheduleTime);
            if (courseTime > now) {
                statusElement.innerHTML = '<span class="badge bg-success">即将开始</span>';
            } else if (courseTime < now) {
                statusElement.innerHTML = '<span class="badge bg-secondary">已结束</span>';
            } else {
                statusElement.innerHTML = '<span class="badge bg-warning">进行中</span>';
            }
            
            document.getElementById('detailCourseCapacity').textContent = `${courseDetails.currentCount || 0}/${courseDetails.maxCapacity || 0}`;
            
            // 显示模态框
            courseDetailModal.show();
        }
        
        // 根据ID获取课程信息
        function getCourseById(id) {
            console.log('getCourseById called with id:', id, 'typeof:', typeof id);
            
            // 直接从表格中获取所有课程数据
            const rows = document.querySelectorAll('#courseTableBody tr');
            console.log('Found', rows.length, 'rows in table');
            
            // 将ID转换为字符串以便比较
            const targetId = String(id).trim();
            
            // 添加调试信息，查看表格的完整HTML
            console.log('Table HTML:', document.getElementById('courseTableBody').innerHTML);
            
            for (let i = 0; i < rows.length; i++) {
                const row = rows[i];
                // 获取所有单元格
                const cells = row.querySelectorAll('td');
                
                console.log('Row', i, 'cells count:', cells.length, 'HTML:', row.innerHTML);
                
                // 检查是否有足够的单元格
                if (cells.length >= 7) {
                    // 获取课程ID（第二列）
                    const rowIdElement = cells[1];
                    const rowId = rowIdElement ? rowIdElement.textContent.trim() : '';
                    console.log('Row', i, 'rowId:', rowId, 'typeof:', typeof rowId);
                    
                    // 精确比较字符串ID
                    if (rowId === targetId) {
                        console.log('Found matching row for id:', id);
                        
                        // 获取各个字段的值
                        const courseName = cells[2] ? cells[2].textContent.trim() : '未知课程';
                        const coachName = cells[3] ? cells[3].querySelector('span:first-child').textContent.trim() : '未知教练';
                        const scheduleTime = cells[4] ? cells[4].textContent.trim() : '未安排';
                        const capacityText = cells[5] ? cells[5].textContent.trim() : '0/0';
                        // 获取教练ID
                        const trainerIdElement = cells[3] ? cells[3].querySelector('.trainer-id') : null;
                        const trainerId = trainerIdElement ? parseInt(trainerIdElement.textContent.trim()) : null;
                        
                        console.log('Course info:', {
                            courseName,
                            coachName,
                            scheduleTime,
                            capacityText
                        });
                        
                        // 解析容量信息
                        const capacityParts = capacityText.split('/');
                        const currentCount = parseInt(capacityParts[0]) || 0;
                        const maxCapacity = parseInt(capacityParts[1]) || 0;
                        
                        // 构建并返回课程对象
                        const course = {
                            id: rowId,
                            name: courseName,
                            coachName: coachName,
                            trainerId: trainerId,
                            scheduleTime: scheduleTime,
                            currentCount: currentCount,
                            maxCapacity: maxCapacity,
                            createdAt: '-', // 表格中没有显示创建时间
                            updatedAt: '-'  // 表格中没有显示更新时间
                        };
                        console.log('Returning course:', course);
                        return course;
                    }
                }
            }
            
            // 如果没有找到课程，返回默认值
            console.log('No course found for id:', id);
            return {
                id: targetId,
                name: '未找到课程',
                coachName: '-',
                scheduleTime: '-',
                currentCount: 0,
                maxCapacity: 0,
                createdAt: '-',
                updatedAt: '-'
            };
        }

        // 编辑课程
        function editCourse(id) {
            console.log('编辑课程:', id);
            
            // 获取课程信息并填充表单
            const course = getCourseById(id);
            if (course && course.scheduleTime) {
                const [date, time] = course.scheduleTime.split(' ');
                
                // 填充编辑模态框表单
                document.getElementById('editCourseId').value = course.id;
                document.getElementById('editCourseName').value = course.name;
                document.getElementById('editCourseTrainer').value = course.trainerId || '';
                document.getElementById('editCourseCapacity').value = course.maxCapacity;
                document.getElementById('editCourseTime').value = date + 'T' + time;
                
                // 显示编辑模态框
                editCourseModal.show();
            }
        }

        // 删除课程
        function deleteCourse(id) {
            // 获取课程信息
            const course = getCourseById(id);
            currentDeleteCourseId = id;
            
            // 设置模态框内容
            document.getElementById('deleteCourseName').textContent = course.name || `ID: ${id}`;
            
            // 显示确认模态框
            deleteCourseModal.show();
        }
        
        // 确认删除课程
        document.getElementById('confirmDelete').addEventListener('click', function() {
            if (currentDeleteCourseId !== null) {
                console.log('删除课程:', currentDeleteCourseId);
                alert(`课程ID: ${currentDeleteCourseId} 已删除`);
                // 这里可以通过AJAX请求删除课程
                
                // 关闭模态框
                deleteCourseModal.hide();
                currentDeleteCourseId = null;
            }
        });

        // 初始化日历
        function initCalendar() {
            renderCalendar();
        }

        // 渲染日历
        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            // 更新当前月份显示
            const monthNames = ['一月', '二月', '三月', '四月', '五月', '六月', '七月', '八月', '九月', '十月', '十一月', '十二月'];
            document.getElementById('currentMonth').textContent = `${year}年 ${monthNames[month]}`;
            
            // 清空日历
            const calendarDays = document.getElementById('calendarDays');
            calendarDays.innerHTML = '';
            
            // 添加星期标题
            const weekdays = ['日', '一', '二', '三', '四', '五', '六'];
            weekdays.forEach(day => {
                const weekdayElement = document.createElement('div');
                weekdayElement.className = 'calendar-day text-center font-weight-bold';
                weekdayElement.textContent = day;
                calendarDays.appendChild(weekdayElement);
            });
            
            // 获取当月第一天
            const firstDay = new Date(year, month, 1);
            // 获取当月最后一天
            const lastDay = new Date(year, month + 1, 0);
            // 获取当月第一天是星期几
            const startingDayOfWeek = firstDay.getDay();
            // 获取当月天数
            const daysInMonth = lastDay.getDate();
            
            // 添加空白单元格
            for (let i = 0; i < startingDayOfWeek; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day';
                calendarDays.appendChild(emptyDay);
            }
            
            // 添加日期单元格
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = day;
                
                // 随机添加一些课程标记
                if (Math.random() > 0.5) {
                    dayElement.style.backgroundColor = '#e3f2fd';
                    dayElement.title = '有课程安排';
                }
                
                dayElement.addEventListener('click', () => {
                    // 移除其他选中状态
                    document.querySelectorAll('.calendar-day.selected').forEach(el => {
                        el.classList.remove('selected');
                    });
                    // 添加选中状态
                    dayElement.classList.add('selected');
                    // 显示当天课程
                    showDayCourses(year, month + 1, day);
                });
                
                calendarDays.appendChild(dayElement);
            }
        }

        // 显示指定日期的课程
        function showDayCourses(year, month, day) {
            const formattedDate = `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
            const coursesList = document.querySelector('#selectedDateCourses .list-group');
            
            // 实际应用中，这里应该通过AJAX请求从后端获取当天的真实课程数据
            // 例如: fetch(`/api/courses?date=${formattedDate}`).then(response => response.json())
            
            // 清空课程列表
            coursesList.innerHTML = '';
            
            // 显示当天没有课程安排
            const noCourseItem = document.createElement('div');
            noCourseItem.className = 'list-group-item text-muted';
            noCourseItem.textContent = '当天没有课程安排';
            coursesList.appendChild(noCourseItem);
        }

        // 切换月份
        function changeMonth(delta) {
            currentDate.setMonth(currentDate.getMonth() + delta);
            renderCalendar();
        }

        // 页面加载时初始化日历
        window.addEventListener('DOMContentLoaded', () => {
            initCalendar();
        });
    </script>
</body>
</html>