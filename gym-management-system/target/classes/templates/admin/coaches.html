<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>教练管理 - 健身房管理系统</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f8f9fa;
        }
        .sidebar {
            min-height: 100vh;
            background-color: #2c3e50;
            color: white;
            padding: 1rem;
        }
        .sidebar h4 {
            border-bottom: 1px solid #34495e;
            padding-bottom: 0.5rem;
            margin-bottom: 1rem;
        }
        .sidebar a {
            color: #ecf0f1;
            display: block;
            padding: 0.5rem 1rem;
            margin-bottom: 0.25rem;
            border-radius: 4px;
            text-decoration: none;
            transition: all 0.3s ease;
        }
        .sidebar a:hover,
        .sidebar a.active {
            background-color: #34495e;
            color: #3498db;
        }
        .content {
            padding: 2rem;
        }
        .card {
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 1.5rem;
        }
        .coach-form {
            background-color: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        .table-container {
            background-color: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            overflow-x: auto;
        }
        .table thead {
            background-color: #f8f9fa;
        }
        .table th,
        .table td {
            padding: 0.75rem 1rem;
            vertical-align: middle;
        }
        .btn {
            font-size: 0.875rem;
            padding: 0.25rem 0.75rem;
            margin: 0 0.25rem;
        }
        .coach-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
        }
        .coach-specialty {
            display: inline-block;
            background-color: #e3f2fd;
            color: #1565c0;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            margin: 0.25rem;
        }
        .form-group {
            margin-bottom: 1.5rem;
        }
        .form-label {
            font-weight: 500;
            margin-bottom: 0.5rem;
        }
        .input-group-text {
            background-color: #f8f9fa;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- 侧边栏 -->
            <div class="col-md-2 sidebar">
                <h4>管理系统</h4>
                <a th:href="@{/admin}">首页</a>
                <a th:href="@{/admin/members}">会员管理</a>
                <a th:href="@{/admin/coaches}" class="active">教练管理</a>
                <a th:href="@{/admin/courses}">课程管理</a>
                <a th:href="@{/admin/cards}">会员卡设置</a>
                <a th:href="@{/logout}">退出登录</a>
            </div>

            <!-- 主内容区 -->
            <div class="col-md-10 content">
                <h2 class="mb-4">教练管理</h2>

                <!-- 添加教练模态框 -->
                <div class="modal fade" id="addCoachModal" tabindex="-1" aria-labelledby="addCoachModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="addCoachModalLabel">添加教练</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <form id="coachForm" enctype="multipart/form-data">
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <label for="coachName" class="form-label">姓名</label>
                                            <div class="input-group">
                                                <span class="input-group-text"><i class="fa fa-user"></i></span>
                                                <input type="text" class="form-control" id="coachName" placeholder="请输入教练姓名" required>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="coachPhone" class="form-label">手机号</label>
                                            <div class="input-group">
                                                <span class="input-group-text"><i class="fa fa-phone"></i></span>
                                                <input type="tel" class="form-control" id="coachPhone" placeholder="请输入手机号" required>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="coachGender" class="form-label">性别</label>
                                            <select class="form-select" id="coachGender" required>
                                                <option value="">请选择性别</option>
                                                <option value="男">男</option>
                                                <option value="女">女</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="coachAge" class="form-label">年龄</label>
                                            <div class="input-group">
                                                <span class="input-group-text"><i class="fa fa-calendar"></i></span>
                                                <input type="number" class="form-control" id="coachAge" min="18" max="65" placeholder="请输入年龄" required>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="coachTitle" class="form-label">职称</label>
                                            <select class="form-select" id="coachTitle" required>
                                                <option value="">请选择职称</option>
                                                <option value="初级教练">初级教练</option>
                                                <option value="中级教练">中级教练</option>
                                                <option value="高级教练">高级教练</option>
                                                <option value="资深教练">资深教练</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="coachSpecialty" class="form-label">专长</label>
                                            <select class="form-select" id="coachSpecialty" required>
                                                <option value="">请选择专长</option>
                                                <option value="力量训练">力量训练</option>
                                                <option value="有氧训练">有氧训练</option>
                                                <option value="瑜伽">瑜伽</option>
                                                <option value="普拉提">普拉提</option>
                                                <option value="拳击">拳击</option>
                                                <option value="功能性训练">功能性训练</option>
                                                <option value="康复训练">康复训练</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="coachSalary" class="form-label">薪资标准 (¥)</label>
                                            <div class="input-group">
                                                <span class="input-group-text">¥</span>
                                                <input type="number" class="form-control" id="coachSalary" min="0" step="0.01" placeholder="请输入薪资" required>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="coachStatus" class="form-label">状态</label>
                                            <select class="form-select" id="coachStatus" required>
                                                <option value="active">在职</option>
                                                <option value="inactive">离职</option>
                                                <option value="vacation">休假</option>
                                            </select>
                                        </div>
                                        <div class="col-md-12">
                                            <label for="coachAvatar" class="form-label">头像</label>
                                            <input type="file" class="form-control" id="coachAvatar" accept="image/*">
                                            <small class="form-text text-muted">支持JPG、PNG格式，建议尺寸200x200</small>
                                        </div>
                                        <div class="col-md-12">
                                            <label for="coachDescription" class="form-label">个人简介</label>
                                            <textarea class="form-control" id="coachDescription" rows="4" placeholder="请输入教练个人简介"></textarea>
                                        </div>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
                                <button type="button" class="btn btn-primary" onclick="saveCoach()">保存教练信息</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 搜索区域 -->
                <div class="search-container" style="background-color: white; padding: 1.5rem; border-radius: 8px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); margin-bottom: 1.5rem;">
                    <div class="row g-3">
                        <div class="col-md-3">
                            <label for="searchCoachName" class="form-label">教练姓名</label>
                            <input type="text" class="form-control" id="searchCoachName" placeholder="请输入教练姓名">
                        </div>
                        <div class="col-md-3">
                            <label for="searchCoachPhone" class="form-label">手机号</label>
                            <input type="text" class="form-control" id="searchCoachPhone" placeholder="请输入手机号">
                        </div>
                        <div class="col-md-2">
                            <label for="searchCoachGender" class="form-label">性别</label>
                            <select class="form-select" id="searchCoachGender">
                                <option value="">全部</option>
                                <option value="男">男</option>
                                <option value="女">女</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label for="searchCoachTitle" class="form-label">职称</label>
                            <select class="form-select" id="searchCoachTitle">
                                <option value="">全部</option>
                                <option value="初级教练">初级教练</option>
                                <option value="中级教练">中级教练</option>
                                <option value="高级教练">高级教练</option>
                                <option value="资深教练">资深教练</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label for="searchCoachStatus" class="form-label">状态</label>
                            <select class="form-select" id="searchCoachStatus">
                                <option value="">全部</option>
                                <option value="active">在职</option>
                                <option value="vacation">休假</option>
                                <option value="inactive">离职</option>
                            </select>
                        </div>
                        <div class="col-md-12 text-center">
                            <button class="btn btn-primary" onclick="searchCoaches()">
                                <i class="fa fa-search"></i> 搜索
                            </button>
                            <button class="btn btn-outline-secondary" onclick="resetSearch()">
                                <i class="fa fa-refresh"></i> 重置
                            </button>
                            <button class="btn btn-success" onclick="showAddCoachModal()">
                                <i class="fa fa-plus"></i> 新增教练
                            </button>
                        </div>
                    </div>
                </div>

                <!-- 教练列表 -->
                <div class="table-container">
                    <h4 class="mb-3">教练列表</h4>
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>头像</th>
                                <th>姓名</th>
                                <th>手机号</th>
                                <th>性别</th>
                                <th>职称</th>
                                <th>专长</th>
                                <th>状态</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="coachTableBody">
                            <tr th:each="coach : ${coaches}">
                                <td><img th:src="${coach.avatar != null ? coach.avatar : 'https://picsum.photos/id/' + (coach.id % 100) + '/50/50'}" class="coach-avatar" alt="头像" th:alt="${coach.name}"></td>
                                <td th:text="${coach.name ?: '未设置'}"></td>
                                <td th:text="${coach.phone}"></td>
                                <td th:text="${coach.gender ?: '未知'}"></td>
                                <td th:text="${coach.title ?: '健身教练'}"></td>
                                <td>
                                    <span class="coach-specialty" th:text="${coach.specialty ?: '未设置'}"></span>
                                </td>
                                <td>
                                    <span class="badge" th:classappend="${coach.status == 'active' ? 'bg-success' : (coach.status == 'vacation' ? 'bg-warning' : 'bg-danger')}"
                                          th:text="${coach.status == 'active' ? '在职' : (coach.status == 'vacation' ? '休假' : '离职')}"></span>
                                </td>
                                <td>
                                    <button class="btn btn-info" th:onclick="'viewCoach(' + ${coach.id} + ')'" title="查看详情"><i class="fa fa-eye"></i></button>
                                    <button class="btn btn-warning" th:onclick="'editCoach(' + ${coach.id} + ')'" title="编辑"><i class="fa fa-edit"></i></button>
                                    <button class="btn btn-danger" th:onclick="'deleteCoach(' + ${coach.id} + ')'" title="删除"><i class="fa fa-trash"></i></button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- 教练详情模态框 -->
    <div class="modal fade" id="coachDetailModal" tabindex="-1" aria-labelledby="coachDetailModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="coachDetailModalLabel">教练详情</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="coachDetailContent">
                    <!-- 教练详情内容将通过JavaScript动态填充 -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 初始化模态框
        const coachDetailModal = new bootstrap.Modal(document.getElementById('coachDetailModal'));
        const addCoachModal = new bootstrap.Modal(document.getElementById('addCoachModal'));
        
        // 显示添加教练模态框
        function showAddCoachModal() {
            resetForm();
            addCoachModal.show();
        }
        
        // 隐藏添加教练模态框
        function hideAddCoachModal() {
            addCoachModal.hide();
        }

        // 保存教练信息
        function saveCoach() {
            // 验证表单
            if (!validateForm()) {
                alert('请填写必填字段并确保格式正确');
                return;
            }

            // 获取表单数据
            const formData = new FormData();
            formData.append('name', document.getElementById('coachName').value);
            formData.append('phone', document.getElementById('coachPhone').value);
            formData.append('gender', document.getElementById('coachGender').value);
            formData.append('age', document.getElementById('coachAge').value);
            formData.append('title', document.getElementById('coachTitle').value);
            formData.append('specialty', document.getElementById('coachSpecialty').value);
            formData.append('salary', document.getElementById('coachSalary').value);
            formData.append('status', document.getElementById('coachStatus').value);
            formData.append('description', document.getElementById('coachDescription').value);
            
            // 添加头像文件
            const avatarFile = document.getElementById('coachAvatar').files[0];
            if (avatarFile) {
                formData.append('avatar', avatarFile);
            }

            // 这里可以通过AJAX请求保存数据
            console.log('保存教练信息:', formData);
            
            // 模拟保存成功
            alert('教练信息保存成功！');
            resetForm();
            hideAddCoachModal();
        }

        // 重置表单
        function resetForm() {
            document.getElementById('coachForm').reset();
        }

        // 表单验证
        function validateForm() {
            const name = document.getElementById('coachName').value;
            const phone = document.getElementById('coachPhone').value;
            const gender = document.getElementById('coachGender').value;
            const age = document.getElementById('coachAge').value;
            const title = document.getElementById('coachTitle').value;
            const specialty = document.getElementById('coachSpecialty').value;
            const salary = document.getElementById('coachSalary').value;

            // 简单验证
            if (!name || !phone || !gender || !age || !title || !specialty || !salary) {
                return false;
            }

            // 手机号验证
            const phoneRegex = /^1[3-9]\d{9}$/;
            if (!phoneRegex.test(phone)) {
                alert('请输入正确的手机号格式');
                return false;
            }

            return true;
        }

        // 查看教练详情
        function viewCoach(id) {
            console.log('查看教练详情:', id);
            
            // 从后端API获取真实的教练详情数据
            fetch(`/admin/coaches/${id}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success && data.data) {
                        const coachDetails = data.data;
                        
                        // 构建详情HTML
                        const statusMap = {
                            active: { text: '在职', class: 'bg-success' },
                            inactive: { text: '离职', class: 'bg-danger' },
                            vacation: { text: '休假', class: 'bg-warning' }
                        };

                        // 使用真实头像或默认头像
                        const avatar = coachDetails.avatar ? coachDetails.avatar : 
                            `https://picsum.photos/id/${coachDetails.id % 100}/200/200`;

                        const detailHTML = `
                            <div class="row">
                                <div class="col-md-4 text-center">
                                    <img src="${avatar}" style="width: 200px; height: 200px; border-radius: 50%; object-fit: cover;" alt="教练头像">
                                </div>
                                <div class="col-md-8">
                                    <h4>${coachDetails.name}</h4>
                                    <p><strong>手机号：</strong>${coachDetails.phone}</p>
                                    <p><strong>性别：</strong>${coachDetails.gender}</p>
                                    <p><strong>职称：</strong>${coachDetails.title}</p>
                                    <p><strong>专长：</strong><span class="coach-specialty">${coachDetails.specialty}</span></p>
                                    <p><strong>状态：</strong><span class="badge ${statusMap[coachDetails.status]?.class || 'bg-secondary'}">${statusMap[coachDetails.status]?.text || coachDetails.status}</span></p>
                                </div>
                            </div>
                            <hr>
                            <div class="row">
                                <div class="col-md-12">
                                    <h5>个人简介</h5>
                                    <p>${coachDetails.description}</p>
                                </div>
                            </div>
                        `;

                        // 填充详情内容
                            document.getElementById('coachDetailContent').innerHTML = detailHTML;
                            
                            // 显示模态框
                            coachDetailModal.show();
                        } else {
                            // 显示错误信息
                            document.getElementById('coachDetailContent').innerHTML = 
                                `<div class="alert alert-danger">${data.message || '获取教练详情失败'}</div>`;
                            
                            // 显示模态框
                            coachDetailModal.show();
                        }
                    })
                    .catch(error => {
                        console.error('获取教练详情出错:', error);
                        document.getElementById('coachDetailContent').innerHTML = 
                            '<div class="alert alert-danger">获取教练详情时发生错误</div>';
                        
                        // 显示模态框
                        coachDetailModal.show();
                    });
        }

        // 编辑教练
        function editCoach(id) {
            console.log('编辑教练:', id);
            
            // 模拟获取教练信息并填充表单
            document.getElementById('coachName').value = `教练${id}`;
            document.getElementById('coachPhone').value = `13800138${String(id).padStart(3, '0')}`;
            document.getElementById('coachGender').value = id % 2 === 0 ? '女' : '男';
            document.getElementById('coachAge').value = 25 + id;
            
            // 滚动到表单顶部
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // 删除教练
        function deleteCoach(id) {
            // 使用更详细的确认信息，提醒用户删除操作的重要性
            const userConfirmed = confirm(`确认要删除此教练信息吗？\n此操作无法撤销，删除后相关数据将无法恢复。\n教练ID: ${id}`);
            
            if (userConfirmed) {
                console.log('用户确认删除教练:', id);
                // 通过AJAX请求后端执行删除操作
                fetch(`/admin/coaches/${id}`, {
                    method: 'DELETE'
                })
                .then(response => {
                    if (response.ok) {
                        alert(`教练信息已成功删除`);
                        // 刷新页面或更新教练列表
                        location.reload();
                    } else {
                        alert('删除失败，请稍后重试');
                    }
                })
                .catch(error => {
                    console.error('删除教练时发生错误:', error);
                    alert('删除过程中发生错误，请稍后重试');
                });
            } else {
                console.log('用户取消删除教练:', id);
                // 明确不执行任何操作，包括不显示任何提示
            }
        }

        // 搜索教练
        function searchCoaches() {
            const name = document.getElementById('searchCoachName').value.trim();
            const phone = document.getElementById('searchCoachPhone').value.trim();
            const gender = document.getElementById('searchCoachGender').value;
            const title = document.getElementById('searchCoachTitle').value;
            const status = document.getElementById('searchCoachStatus').value;
            console.log('搜索条件:', {name, phone, gender, title, status});
            
            // 获取所有教练行
            const rows = document.querySelectorAll('#coachTableBody tr');
            rows.forEach(row => {
                const nameCell = row.querySelector('td:nth-child(2)');
                const phoneCell = row.querySelector('td:nth-child(3)');
                const genderCell = row.querySelector('td:nth-child(4)');
                const titleCell = row.querySelector('td:nth-child(5)');
                const statusCell = row.querySelector('td:nth-child(7)');
                
                let match = true;
                
                // 按姓名筛选
                if (name && nameCell && !nameCell.textContent.toLowerCase().includes(name.toLowerCase())) {
                    match = false;
                }
                
                // 按手机号筛选
                if (phone && phoneCell && !phoneCell.textContent.includes(phone)) {
                    match = false;
                }
                
                // 按性别筛选
                if (gender && genderCell && genderCell.textContent !== gender) {
                    match = false;
                }
                
                // 按职称筛选
                if (title && titleCell && titleCell.textContent !== title) {
                    match = false;
                }
                
                // 按状态筛选
                if (status && statusCell) {
                    const statusText = statusCell.textContent;
                    const statusValue = statusText === '在职' ? 'active' : (statusText === '休假' ? 'vacation' : 'inactive');
                    if (statusValue !== status) {
                        match = false;
                    }
                }
                
                row.style.display = match ? '' : 'none';
            });
        }

        // 重置搜索
        function resetSearch() {
            document.getElementById('searchCoachName').value = '';
            document.getElementById('searchCoachPhone').value = '';
            document.getElementById('searchCoachGender').value = '';
            document.getElementById('searchCoachTitle').value = '';
            document.getElementById('searchCoachStatus').value = '';
            
            // 显示所有教练
            const rows = document.querySelectorAll('#coachTableBody tr');
            rows.forEach(row => {
                row.style.display = '';
            });
        }
    </script>
</body>
</html>