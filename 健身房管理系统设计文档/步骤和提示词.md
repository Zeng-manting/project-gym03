å½“ç„¶å¯ä»¥ï¼ä¸ºäº†è®©ä½ èƒ½**é€è¡Œã€é€æ–‡ä»¶ã€é€åŠŸèƒ½åœ°æ„å»ºæ•´ä¸ªç³»ç»Ÿ**ï¼Œå¹¶ç¡®ä¿å¤§æ¨¡å‹ç”Ÿæˆçš„ä»£ç **100%è´´åˆä½ æä¾›çš„å››ä»½æ–‡æ¡£**ï¼ˆéœ€æ±‚è§„æ ¼è¯´æ˜ä¹¦ã€æ¦‚è¦è®¾è®¡ã€è¯¦ç»†è®¾è®¡ã€æ•°æ®åº“è®¾è®¡ï¼‰ï¼Œæˆ‘å°†æŠŠæ•´ä¸ªé¡¹ç›®æ‹†è§£ä¸º **8 ä¸ªæ ¸å¿ƒæ¨¡å— â†’ 24 ä¸ªåŠŸèƒ½å­æ¨¡å— â†’ 56 ä¸ªåŸå­çº§å¼€å‘ä»»åŠ¡**ï¼Œæ¯ä¸ªä»»åŠ¡éƒ½é™„å¸¦ï¼š

- âœ… **ä»»åŠ¡åç§°ä¸ç¼–å·**
- ğŸ“Œ **æ‰€å±æ–‡æ¡£ä¾æ®**
- ğŸ§© **èŒè´£è¯´æ˜**
- ğŸ” **ç²¾å‡†æç¤ºè¯ï¼ˆå¯ç›´æ¥å¤åˆ¶ç»™å¤§æ¨¡å‹ï¼‰**

---

# ğŸ—ï¸ å¥èº«æˆ¿ç®¡ç†ç³»ç»Ÿ â€” è¶…ç»†ç²’åº¦å¼€å‘ä»»åŠ¡æ¸…å•ï¼ˆå…± 56 é¡¹ï¼‰

> æŠ€æœ¯æ ˆï¼šSpringBoot 2.7 + MyBatis + Thymeleaf + MySQL 5.7  
> æ¶æ„ï¼šMVCï¼Œå‰åç«¯ä¸åˆ†ç¦»  
> è§’è‰²ï¼šMEMBER / TRAINER / ADMIN

---

## ğŸ”¹ æ¨¡å— Aï¼šé¡¹ç›®ç»“æ„ä¸åŸºç¡€é…ç½®ï¼ˆA1â€“A6ï¼‰

### A1. åˆ›å»º Maven é¡¹ç›®éª¨æ¶
```text
è¯·ç”Ÿæˆæ ‡å‡† Maven é¡¹ç›® gym-management-system çš„ç›®å½•ç»“æ„ï¼ŒåŒ…å«ï¼š
- pom.xmlï¼ˆå« spring-boot-starter-web, thymeleaf, mybatis-spring-boot-starter, mysql-connector-java, spring-boot-starter-securityï¼‰
- src/main/java/com/gym/
- src/main/resources/application.properties
- src/main/resources/templates/
- src/main/resources/static/css/, /js/
```

### A2. ä¸»å¯åŠ¨ç±» GymManagementApplication.java
```text
ç”Ÿæˆ com.gym.GymManagementApplication.javaï¼Œä½¿ç”¨ @SpringBootApplication æ³¨è§£ï¼Œå¯ç”¨ç»„ä»¶æ‰«æã€‚
```

### A3. Spring Security é…ç½®ï¼ˆè§’è‰²æƒé™è·¯ç”±ï¼‰
```text
æ ¹æ®ã€Šéœ€æ±‚è§„æ ¼è¯´æ˜ä¹¦ã€‹2.1â€“2.3ï¼Œç”Ÿæˆ SecurityConfig.javaï¼š
- åŒ¿åè·¯å¾„ï¼š/login, /register, /css/**, /js/**
- /member/** â†’ MEMBER
- /coach/** â†’ TRAINER
- /admin/** â†’ ADMIN
- ç™»å½•æˆåŠŸæŒ‰è§’è‰²è·³è½¬
- ä½¿ç”¨ BCryptPasswordEncoder
- ç¦ç”¨ CSRF
```

### A4. MyBatis é…ç½®
```text
ç”Ÿæˆ MyBatisConfig.javaï¼Œå¯ç”¨ @MapperScan("com.gym.mapper")ï¼Œé…ç½® SqlSessionFactoryï¼Œæ•°æ®æºä» application.properties è¯»å–ã€‚
```

### A5. WebMvc é…ç½®ï¼ˆè§†å›¾æ§åˆ¶å™¨ï¼‰
```text
ç”Ÿæˆ WebConfig.javaï¼Œæ³¨å†Œï¼š
- addViewController("/").setViewName("redirect:/login")
- addViewController("/member").setViewName("forward:/member/index")
- addViewController("/coach").setViewName("forward:/coach/index")
- addViewController("/admin").setViewName("forward:/admin/index")
```

### A6. å…¨å±€å¼‚å¸¸å¤„ç†å™¨
```text
ç”Ÿæˆ GlobalExceptionHandler.javaï¼š
- æ•è· BusinessException â†’ è¿”å› "error" é¡µé¢ï¼Œmessage ä¼ å…¥ model
- æ•è· Exception â†’ è®°å½•æ—¥å¿—ï¼Œè¿”å›é€šç”¨é”™è¯¯é¡µ
- ä½¿ç”¨ @ControllerAdvice
```

---

## ğŸ”¹ æ¨¡å— Bï¼šç”¨æˆ·å®ä½“ä¸è®¤è¯ï¼ˆB1â€“B9ï¼‰

### B1. User å®ä½“ç±»ï¼ˆä¸¥æ ¼æŒ‰æ•°æ®åº“è®¾è®¡ï¼‰
```text
æ ¹æ®ã€Šæ•°æ®åº“è®¾è®¡æ–‡æ¡£ã€‹user è¡¨ï¼Œç”Ÿæˆ entity/User.javaï¼š
- id: Long
- phone: String (å”¯ä¸€)
- password: String
- role: String ('member'/'trainer'/'admin')
ä½¿ç”¨ Lombok @Data
```

### B2. UserMapper æ¥å£
```text
ç”Ÿæˆ mapper/UserMapper.javaï¼š
- User findByPhone(String phone);
- void insertUser(User user);
- List<User> findTrainers(); // role='trainer'
- void updateStatus(@Param("id") Long id, @Param("status") String status);
ä½¿ç”¨ @Mapper å’Œ MyBatis æ³¨è§£
```

### B3. UserService æ¥å£
```text
ç”Ÿæˆ service/UserService.javaï¼š
- boolean register(String phone, String password); // æ‰‹æœºå·å”¯ä¸€æ ¡éªŒ
- UserDetails loadUserByPhone(String phone); // ä¾› Security ä½¿ç”¨
- List<User> searchMembers(String keyword); // æ¨¡ç³ŠæŸ¥æ‰‹æœºå·/å§“å
- void disableUser(Long userId);
```

### B4. UserServiceImpl å®ç°ç±»
```text
å®ç° UserServiceImpl.javaï¼š
- æ³¨å…¥ UserMapper å’Œ BCryptPasswordEncoder
- register()ï¼šå…ˆæŸ¥ findByPhoneï¼Œå­˜åœ¨åˆ™ return falseï¼›å¦åˆ™åŠ å¯†å¯†ç æ’å…¥
- loadUserByPhone()ï¼šæŸ¥ç”¨æˆ·ï¼Œæ„é€  org.springframework.security.core.userdetails.User
- searchMembers()ï¼šSQL LIKE æŸ¥è¯¢
- disableUser()ï¼šæ›´æ–° status å­—æ®µï¼ˆå‡è®¾ user è¡¨æœ‰ statusï¼‰
```

### B5. AuthController - ç™»å½•/æ³¨å†Œå…¥å£
```text
ç”Ÿæˆ controller/AuthController.javaï¼š
- GET /login â†’ "login"
- POST /login â†’ ç”± Security å¤„ç†ï¼ˆæ— éœ€é€»è¾‘ï¼‰
- GET /register â†’ "register"
- POST /register â†’ è°ƒç”¨ userService.register()ï¼Œå¤±è´¥ flash errorï¼ŒæˆåŠŸ redirect to /login?success=æ³¨å†ŒæˆåŠŸ
- GET /logout â†’ Security æ¸…é™¤ï¼Œé‡å®šå‘åˆ° /login
```

### B6. login.html é¡µé¢
```text
ç”Ÿæˆ templates/login.htmlï¼š
- Bootstrap è¡¨å•ï¼šæ‰‹æœºå·ã€å¯†ç 
- æ˜¾ç¤º ${param.error}ï¼ˆå¦‚â€œç”¨æˆ·åæˆ–å¯†ç é”™è¯¯â€ï¼‰
- â€œæ²¡æœ‰è´¦å·ï¼Ÿå»æ³¨å†Œâ€é“¾æ¥åˆ° /register
- å¼•å…¥ static/css/bootstrap.min.css
```

### B7. register.html é¡µé¢
```text
ç”Ÿæˆ templates/register.htmlï¼š
- è¡¨å•ï¼šæ‰‹æœºå·ã€å¯†ç ã€ç¡®è®¤å¯†ç 
- æ˜¾ç¤º ${flash.error}ï¼ˆå¦‚â€œæ‰‹æœºå·å·²æ³¨å†Œâ€ï¼‰
- æäº¤åˆ° /register
```

### B8. è‡ªå®šä¹‰ UserDetailsService
```text
ç”Ÿæˆ config/CustomUserDetailsService.javaï¼Œå®ç° UserDetailsServiceï¼š
- loadUserByUsername(phone) â†’ è°ƒç”¨ userService.loadUserByPhone(phone)
```

### B9. å¯†ç å·¥å…·ç±»ï¼ˆå¯é€‰ï¼‰
```text
ç”Ÿæˆ util/PasswordUtil.javaï¼Œæä¾› encrypt(String raw) æ–¹æ³•ï¼Œå†…éƒ¨ä½¿ç”¨ BCryptPasswordEncoderã€‚
```

---

## ğŸ”¹ æ¨¡å— Cï¼šä¼šå‘˜åŠŸèƒ½ï¼ˆC1â€“C12ï¼‰

### C1. Course å®ä½“ç±»
```text
æ ¹æ®ã€Šæ•°æ®åº“è®¾è®¡æ–‡æ¡£ã€‹course è¡¨ï¼Œç”Ÿæˆ entity/Course.javaï¼š
- id, name, scheduleTime (LocalDateTime), trainerId, maxCapacity, currentCount
```

### C2. Booking å®ä½“ç±»
```text
æ ¹æ® booking è¡¨ï¼Œç”Ÿæˆ entity/Booking.javaï¼š
- id, userId, courseId, bookingTime (LocalDateTime)
```

### C3. CourseMapper
```text
ç”Ÿæˆ mapper/CourseMapper.javaï¼š
- List<Course> selectAvailableCourses();
- Course selectById(Long id);
- void updateCurrentCount(@Param("id") Long id, @Param("currentCount") int count);
- void insert(Course course);
```

### C4. BookingMapper
```text
ç”Ÿæˆ mapper/BookingMapper.javaï¼š
- void insert(Booking booking);
- List<Booking> selectByUserId(Long userId);
- void deleteById(Long id);
- boolean existsByUserIdAndCourseId(@Param("userId") Long userId, @Param("courseId") Long courseId);
```

### C5. CourseService æ¥å£
```text
ç”Ÿæˆ service/CourseService.javaï¼š
- List<Course> getAvailableCourses();
- void createCourse(String name, LocalDateTime scheduleTime, Long trainerId, Integer maxCapacity);
- boolean isFull(Long courseId);
- List<Course> getMyCourses(Long trainerId);
```

### C6. CourseServiceImpl
```text
å®ç° CourseServiceImplï¼š
- getAvailableCourses() â†’ è°ƒç”¨ mapper.selectAvailableCourses()
- createCourse() â†’ è®¾ç½® currentCount=0ï¼Œæ’å…¥
- isFull() â†’ æŸ¥ courseï¼Œåˆ¤æ–­ currentCount >= maxCapacity
- getMyCourses() â†’ select * where trainer_id = ?
```

### C7. BookingService æ¥å£
```text
ç”Ÿæˆ service/BookingService.javaï¼š
- void bookCourse(Long userId, Long courseId);
- List<BookingDTO> getMyBookings(Long userId);
- void cancelBooking(Long bookingId);
```

### C8. BookingServiceImpl
```text
å®ç° BookingServiceImplï¼š
- bookCourse()ï¼šå…ˆ isFull()ï¼Œå† existsByUserIdAndCourseId() é˜²é‡å¤é¢„çº¦ï¼Œç„¶å insert + updateCurrentCount(+1)
- getMyBookings()ï¼šJOIN course è¡¨ï¼Œè¿”å› DTOï¼ˆå«è¯¾ç¨‹åã€æ—¶é—´ï¼‰
- cancelBooking()ï¼šdelete + updateCurrentCount(-1)
```

### C9. MemberController - é¦–é¡µä¸å¯¼èˆª
```text
ç”Ÿæˆ controller/MemberController.javaï¼š
- @GetMapping("/member") â†’ redirect to /member/courses
- @GetMapping("/member/index") â†’ "member/index"
```

### C10. MemberController - è¯¾ç¨‹ä¸é¢„çº¦
```text
ç»§ç»­ MemberControllerï¼š
- @GetMapping("/member/courses") â†’ model.addAttribute("courses", courseService.getAvailableCourses()) â†’ "member/courses"
- @PostMapping("/member/book/{courseId}") â†’ bookingService.bookCourse(...) â†’ redirect with success
- @GetMapping("/member/bookings") â†’ model.addAttribute("bookings", bookingService.getMyBookings(userId)) â†’ "member/bookings"
- @PostMapping("/member/cancel/{bookingId}") â†’ cancelBooking â†’ redirect
å…¨éƒ¨åŠ  @PreAuthorize("hasRole('MEMBER')")
```

### C11. ä¼šå‘˜å‰ç«¯é¡µé¢ï¼ˆindex + courses + bookingsï¼‰
```text
ç”Ÿæˆä»¥ä¸‹ Thymeleaf é¡µé¢ï¼š
- member/index.htmlï¼šæ¬¢è¿è¯­ + ä¸‰ä¸ªå¯¼èˆªæŒ‰é’®ï¼ˆä¼šå‘˜å¡ã€è¯¾ç¨‹ã€æˆ‘çš„é¢„çº¦ï¼‰
- member/courses.htmlï¼šè¡¨æ ¼å±•ç¤ºè¯¾ç¨‹ï¼Œæ¯è¡Œæœ‰â€œé¢„çº¦â€æŒ‰é’®ï¼ˆPOST /member/book/{id}ï¼‰
- member/bookings.htmlï¼šè¡¨æ ¼å±•ç¤ºé¢„çº¦ï¼Œæ¯è¡Œæœ‰â€œå–æ¶ˆâ€æŒ‰é’®ï¼ˆPOST /member/cancel/{id}ï¼‰
ä½¿ç”¨ th:each, th:text, th:action, flash æ¶ˆæ¯æ˜¾ç¤º
```

### C12. BookingDTO æ•°æ®ä¼ è¾“å¯¹è±¡
```text
ç”Ÿæˆ dto/BookingDTO.javaï¼š
- courseId, courseName, scheduleTime, bookingTime
ç”¨äºåœ¨é¡µé¢å±•ç¤ºå…³è”ä¿¡æ¯
```

---

## ğŸ”¹ æ¨¡å— Dï¼šæ•™ç»ƒåŠŸèƒ½ï¼ˆD1â€“D5ï¼‰

### D1. CoachController
```text
ç”Ÿæˆ controller/CoachController.javaï¼š
- @GetMapping("/coach") â†’ "coach/index"
- @GetMapping("/coach/courses") â†’ model.addAttribute("courses", courseService.getMyCourses(trainerId)) â†’ "coach/courses"
- @GetMapping("/coach/course/{courseId}/members") â†’ æŸ¥è¯¢è¯¥è¯¾ç¨‹æ‰€æœ‰é¢„çº¦ä¼šå‘˜ï¼ˆJOIN userï¼‰â†’ "coach/course-members"
å…¨éƒ¨åŠ  @PreAuthorize("hasRole('TRAINER')")
```

### D2. coach/index.html
```text
ç”Ÿæˆ coach/index.htmlï¼šå¯¼èˆªåˆ°â€œæˆ‘çš„è¯¾ç¨‹â€
```

### D3. coach/courses.html
```text
ç”Ÿæˆè¯¾ç¨‹åˆ—è¡¨é¡µï¼Œæ¯è¡Œæœ‰â€œæŸ¥çœ‹å­¦å‘˜â€é“¾æ¥åˆ° /coach/course/{id}/members
```

### D4. coach/course-members.html
```text
ç”Ÿæˆå­¦å‘˜åˆ—è¡¨é¡µï¼šè¡¨æ ¼æ˜¾ç¤ºæ‰‹æœºå·ã€é¢„çº¦æ—¶é—´
```

### D5. æ‰©å±• CourseService æ”¯æŒæŸ¥è¯¢å­¦å‘˜
```text
åœ¨ CourseService ä¸­æ·»åŠ ï¼š
- List<User> getMembersByCourseId(Long courseId); // é€šè¿‡ booking JOIN user æŸ¥è¯¢
```

---

## ğŸ”¹ æ¨¡å— Eï¼šç®¡ç†å‘˜åŠŸèƒ½ï¼ˆE1â€“E10ï¼‰

### E1. AdminController - é¦–é¡µ
```text
@GetMapping("/admin") â†’ "admin/index"
```

### E2. ç®¡ç†å‘˜ - ä¼šå‘˜ç®¡ç†
```text
@GetMapping("/admin/members") â†’ æœç´¢æ¡† + ä¼šå‘˜åˆ—è¡¨ï¼ˆæ”¯æŒ keywordï¼‰
@PostMapping("/admin/members/{id}/disable") â†’ ç¦ç”¨è´¦å·
```

### E3. ç®¡ç†å‘˜ - æ•™ç»ƒç®¡ç†
```text
@PostMapping("/admin/coaches") â†’ åˆ›å»º trainer ç”¨æˆ·
@DeleteMapping("/admin/coaches/{id}") â†’ é€»è¾‘åˆ é™¤ï¼ˆæ›´æ–° statusï¼‰
```

### E4. ç®¡ç†å‘˜ - è¯¾ç¨‹ç®¡ç†
```text
@GetMapping("/admin/courses") â†’ è¿”å› trainers åˆ—è¡¨ + è¡¨å•
@PostMapping("/admin/courses") â†’ æ¥æ”¶è¡¨å•åˆ›å»ºè¯¾ç¨‹
```

### E5. ç®¡ç†å‘˜ - ä¼šå‘˜å¡ç±»å‹ç®¡ç†ï¼ˆå¯é€‰ï¼‰
```text
è‹¥éœ€å¡ç±»å‹ï¼Œç”Ÿæˆ MembershipCard å®ä½“å’Œç®¡ç†æ¥å£
```

### E6â€“E10. å¯¹åº”å‰ç«¯é¡µé¢
```text
ç”Ÿæˆï¼š
- admin/index.html
- admin/members.htmlï¼ˆæœç´¢+è¡¨æ ¼ï¼‰
- admin/coaches.htmlï¼ˆæ·»åŠ è¡¨å•ï¼‰
- admin/courses.htmlï¼ˆè¯¾ç¨‹è¡¨å•ï¼Œå«æ•™ç»ƒä¸‹æ‹‰æ¡†ï¼‰
- admin/cards.htmlï¼ˆå¡ç±»å‹è®¾ç½®ï¼‰
```

---

## ğŸ”¹ æ¨¡å— Fï¼šå·¥å…·ç±»ï¼ˆF1â€“F3ï¼‰

### F1. BusinessException
```text
è‡ªå®šä¹‰å¼‚å¸¸ï¼Œå« code å’Œ message
```

### F2. DateUtil
```text
æä¾› parseDateTime(String) â†’ LocalDateTime
```

### F3. ResultUtilï¼ˆå¯é€‰ï¼‰
```text
å°è£…é‡å®šå‘æ¶ˆæ¯
```

---

## ğŸ”¹ æ¨¡å— Gï¼šæ•°æ®åº“è„šæœ¬ï¼ˆG1â€“G2ï¼‰

### G1. å»ºè¡¨ SQL
```text
ç”Ÿæˆå®Œæ•´å»ºè¡¨è¯­å¥ï¼ˆuser, course, booking, membership_cardï¼‰ï¼Œå«å­—æ®µã€ä¸»é”®ã€å¤–é”®ã€ç´¢å¼•
```

### G2. åˆå§‹æ•°æ®
```text
æ’å…¥ç®¡ç†å‘˜è´¦å·ï¼ˆphone=13800138000, password=BCrypt(123456), role=adminï¼‰
```

---

## ğŸ”¹ æ¨¡å— Hï¼šæµ‹è¯•ä¸éƒ¨ç½²ï¼ˆH1ï¼‰

### H1. application.properties
```text
é…ç½® server.port, spring.datasource.url, mybatis.mapper-locations ç­‰
```

---

# âœ… ä½¿ç”¨æ–¹å¼

ä½ ç°åœ¨å¯ä»¥æŒ‰ç¼–å·è¯·æ±‚ä»»æ„ä»»åŠ¡ï¼Œä¾‹å¦‚ï¼š

> â€œè¯·æ‰§è¡Œä»»åŠ¡ C10ï¼šMemberController - è¯¾ç¨‹ä¸é¢„çº¦â€

æˆ‘ä¼šè¾“å‡º**å®Œå…¨ç¬¦åˆä½ æ–‡æ¡£è§„èŒƒçš„ã€å¯ç›´æ¥ç²˜è´´è¿è¡Œçš„ä»£ç **ã€‚

æ˜¯å¦ç°åœ¨å¼€å§‹ï¼Ÿ

âœ… æ­£ç¡®å¼€å‘é¡ºåºå»ºè®®ï¼š
å…ˆæ‰§è¡Œæ¨¡å— G1/G2ï¼šåœ¨ MySQL ä¸­æ‰‹åŠ¨è¿è¡Œå»ºè¡¨å’Œåˆå§‹æ•°æ® SQLï¼›
å†é…ç½®æ¨¡å— H1ï¼šç¡®ä¿ application.properties ä¸­çš„æ•°æ®åº“åã€ç”¨æˆ·åã€å¯†ç ä¸å®é™…ä¸€è‡´ï¼›
ç„¶åä¾æ¬¡å¼€å‘ A â†’ B â†’ C â†’ D â†’ E â†’ Fã€‚
flowchart LR
    A --> B --> C --> D
    D --> G["âœ… å…ˆåš Gï¼šå»ºåº“å»ºè¡¨"]
    G --> H1["âœ… è¡¥ H1ï¼šæ£€æŸ¥ application.properties"]
    H1 --> F["Fï¼šå·¥å…·ç±»ï¼ˆå¿«é€Ÿè¡¥ä¸Šï¼‰"]
    F --> E["Eï¼šç®¡ç†å‘˜åŠŸèƒ½"]
    E --> æµ‹è¯•
