# 健身房管理系统详细设计文档

## 1. 引言

### 1.1 文档目的
本文档基于健身房管理系统的需求规格说明书和概要设计文档，提供系统的详细设计，包括类设计、方法设计、数据库实现、前端页面设计等内容，为开发人员提供具体的实现指导。

## 2. 项目文件目录结构

```
gym-management-system/                 # 项目根目录
├── src/                               # 源代码目录
│   ├── main/                          # 主要代码
│   │   ├── java/com/gym/              # Java源代码包
│   │   │   ├── config/                # 系统配置
│   │   │   │   ├── SecurityConfig.java      # 安全配置
│   │   │   │   ├── MyBatisConfig.java       # MyBatis配置
│   │   │   │   └── WebConfig.java           # Web配置
│   │   │   ├── controller/            # 控制器层
│   │   │   │   ├── AuthController.java      # 认证相关控制器
│   │   │   │   ├── MemberController.java    # 会员控制器
│   │   │   │   ├── CoachController.java     # 教练控制器
│   │   │   │   ├── AdminController.java     # 管理员控制器
│   │   │   │   └── GlobalExceptionHandler.java # 全局异常处理
│   │   │   ├── service/               # 业务层
│   │   │   │   ├── impl/              # 业务实现
│   │   │   │   │   ├── UserServiceImpl.java     # 用户服务实现
│   │   │   │   │   ├── CourseServiceImpl.java   # 课程服务实现
│   │   │   │   │   ├── BookingServiceImpl.java  # 预约服务实现
│   │   │   │   │   └── MembershipCardServiceImpl.java # 会员卡服务实现
│   │   │   │   ├── UserService.java         # 用户服务接口
│   │   │   │   ├── CourseService.java       # 课程服务接口
│   │   │   │   ├── BookingService.java      # 预约服务接口
│   │   │   │   └── MembershipCardService.java # 会员卡服务接口
│   │   │   ├── mapper/                # 数据访问层
│   │   │   │   ├── UserMapper.java
│   │   │   │   ├── CourseMapper.java
│   │   │   │   ├── BookingMapper.java
│   │   │   │   └── MembershipCardMapper.java
│   │   │   ├── entity/                # 实体类
│   │   │   │   ├── User.java
│   │   │   │   ├── Course.java
│   │   │   │   ├── Booking.java
│   │   │   │   └── MembershipCard.java
│   │   │   ├── dto/                   # 数据传输对象
│   │   │   │   ├── LoginDTO.java
│   │   │   │   ├── RegisterDTO.java
│   │   │   │   ├── CourseDTO.java
│   │   │   │   └── BookingDTO.java
│   │   │   ├── util/                  # 工具类
│   │   │   │   ├── MD5Util.java
│   │   │   │   ├── DateUtil.java
│   │   │   │   └── ResultUtil.java
│   │   │   ├── exception/             # 异常处理
│   │   │   │   ├── GlobalException.java
│   │   │   │   └── BusinessException.java
│   │   │   └── GymManagementApplication.java # 应用启动类
│   │   ├── resources/                 # 资源文件
│   │   │   ├── mapper/                # MyBatis映射文件
│   │   │   │   ├── UserMapper.xml
│   │   │   │   ├── CourseMapper.xml
│   │   │   │   ├── BookingMapper.xml
│   │   │   │   └── MembershipCardMapper.xml
│   │   │   ├── static/                # 静态资源
│   │   │   │   ├── css/               # CSS文件
│   │   │   │   │   └── style.css
│   │   │   │   ├── js/                # JavaScript文件
│   │   │   │   │   └── common.js
│   │   │   │   └── images/            # 图片资源
│   │   │   ├── templates/             # Thymeleaf模板
│   │   │   │   ├── common/            # 公共模板
│   │   │   │   │   ├── header.html
│   │   │   │   │   └── footer.html
│   │   │   │   ├── auth/              # 认证相关页面
│   │   │   │   │   ├── login.html
│   │   │   │   │   └── register.html
│   │   │   │   ├── member/            # 会员页面
│   │   │   │   │   ├── index.html     # 会员中心
│   │   │   │   │   ├── card.html      # 会员卡页面
│   │   │   │   │   ├── courses.html   # 课程列表
│   │   │   │   │   └── bookings.html  # 我的预约
│   │   │   │   ├── coach/             # 教练页面
│   │   │   │   │   ├── index.html     # 教练中心
│   │   │   │   │   └── course-members.html # 预约会员列表
│   │   │   │   └── admin/             # 管理员页面
│   │   │   │       ├── index.html     # 管理面板
│   │   │   │       ├── members.html   # 会员管理
│   │   │   │       ├── coaches.html   # 教练管理
│   │   │   │       ├── courses.html   # 课程管理
│   │   │   │       └── card-types.html # 会员卡类型管理
│   │   │   ├── application.properties # 应用配置
│   │   │   └── logback-spring.xml     # 日志配置
│   └── test/                          # 测试代码
│       └── java/com/gym/              # 测试包
├── pom.xml                            # Maven配置文件
└── README.md                          # 项目说明
```

## 3. 详细类设计

### 3.1 实体类设计

#### 3.1.1 User.java
```java
package com.gym.entity;

import java.util.Date;

public class User {
    private Long id;
    private String phone;
    private String password;
    private String type; // MEMBER, COACH, ADMIN
    private String name;
    private Integer status; // 1-启用，0-禁用
    private Date createTime;
    
    // getter and setter methods
    public Long getId() { return id; }
    public void setId(Long id) { this.id = id; }
    public String getPhone() { return phone; }
    public void setPhone(String phone) { this.phone = phone; }
    public String getPassword() { return password; }
    public void setPassword(String password) { this.password = password; }
    public String getType() { return type; }
    public void setType(String type) { this.type = type; }
    public String getName() { return name; }
    public void setName(String name) { this.name = name; }
    public Integer getStatus() { return status; }
    public void setStatus(Integer status) { this.status = status; }
    public Date getCreateTime() { return createTime; }
    public void setCreateTime(Date createTime) { this.createTime = createTime; }
}
```

#### 3.1.2 MembershipCard.java
```java
package com.gym.entity;

import java.math.BigDecimal;
import java.util.Date;

public class MembershipCard {
    private Long id;
    private Long userId;
    private String cardType;
    private BigDecimal price;
    private Date startDate;
    private Date endDate;
    private Integer status; // 1-有效，0-过期
    
    // getter and setter methods
    public Long getId() { return id; }
    public void setId(Long id) { this.id = id; }
    public Long getUserId() { return userId; }
    public void setUserId(Long userId) { this.userId = userId; }
    public String getCardType() { return cardType; }
    public void setCardType(String cardType) { this.cardType = cardType; }
    public BigDecimal getPrice() { return price; }
    public void setPrice(BigDecimal price) { this.price = price; }
    public Date getStartDate() { return startDate; }
    public void setStartDate(Date startDate) { this.startDate = startDate; }
    public Date getEndDate() { return endDate; }
    public void setEndDate(Date endDate) { this.endDate = endDate; }
    public Integer getStatus() { return status; }
    public void setStatus(Integer status) { this.status = status; }
}
```

#### 3.1.3 Course.java
```java
package com.gym.entity;

import java.util.Date;

public class Course {
    private Long id;
    private String name;
    private Long coachId;
    private Date courseTime;
    private Integer maxCount;
    private Integer currentCount;
    private String status; // NOT_STARTED, IN_PROGRESS, FINISHED
    
    // getter and setter methods
    public Long getId() { return id; }
    public void setId(Long id) { this.id = id; }
    public String getName() { return name; }
    public void setName(String name) { this.name = name; }
    public Long getCoachId() { return coachId; }
    public void setCoachId(Long coachId) { this.coachId = coachId; }
    public Date getCourseTime() { return courseTime; }
    public void setCourseTime(Date courseTime) { this.courseTime = courseTime; }
    public Integer getMaxCount() { return maxCount; }
    public void setMaxCount(Integer maxCount) { this.maxCount = maxCount; }
    public Integer getCurrentCount() { return currentCount; }
    public void setCurrentCount(Integer currentCount) { this.currentCount = currentCount; }
    public String getStatus() { return status; }
    public void setStatus(String status) { this.status = status; }
}
```

#### 3.1.4 Booking.java
```java
package com.gym.entity;

import java.util.Date;

public class Booking {
    private Long id;
    private Long userId;
    private Long courseId;
    private Date bookingTime;
    private String status; // BOOKED, CANCELLED
    
    // getter and setter methods
    public Long getId() { return id; }
    public void setId(Long id) { this.id = id; }
    public Long getUserId() { return userId; }
    public void setUserId(Long userId) { this.userId = userId; }
    public Long getCourseId() { return courseId; }
    public void setCourseId(Long courseId) { this.courseId = courseId; }
    public Date getBookingTime() { return bookingTime; }
    public void setBookingTime(Date bookingTime) { this.bookingTime = bookingTime; }
    public String getStatus() { return status; }
    public void setStatus(String status) { this.status = status; }
}
```

### 3.2 数据传输对象（DTO）设计

#### 3.2.1 LoginDTO.java
```java
package com.gym.dto;

public class LoginDTO {
    private String phone;
    private String password;
    
    // getter and setter methods
    public String getPhone() { return phone; }
    public void setPhone(String phone) { this.phone = phone; }
    public String getPassword() { return password; }
    public void setPassword(String password) { this.password = password; }
}
```

#### 3.2.2 CourseDTO.java
```java
package com.gym.dto;

import java.util.Date;

public class CourseDTO {
    private String name;
    private Long coachId;
    private Date courseTime;
    private Integer maxCount;
    
    // getter and setter methods
    public String getName() { return name; }
    public void setName(String name) { this.name = name; }
    public Long getCoachId() { return coachId; }
    public void setCoachId(Long coachId) { this.coachId = coachId; }
    public Date getCourseTime() { return courseTime; }
    public void setCourseTime(Date courseTime) { this.courseTime = courseTime; }
    public Integer getMaxCount() { return maxCount; }
    public void setMaxCount(Integer maxCount) { this.maxCount = maxCount; }
}
```

### 3.3 服务接口设计

#### 3.3.1 UserService.java
```java
package com.gym.service;

import com.gym.entity.User;
import com.gym.dto.LoginDTO;

import java.util.List;

public interface UserService {
    // 用户注册
    User register(String phone, String password, String name, String type);
    
    // 用户登录
    User login(LoginDTO loginDTO);
    
    // 根据手机号查找用户
    User findByPhone(String phone);
    
    // 根据ID查找用户
    User findById(Long id);
    
    // 更新用户状态
    void updateStatus(Long id, Integer status);
    
    // 查找所有会员
    List<User> findAllMembers(String keyword);
    
    // 查找所有教练
    List<User> findAllCoaches();
    
    // 添加教练
    User addCoach(String name, String phone);
    
    // 删除教练
    void deleteCoach(Long id);
}
```

#### 3.3.2 CourseService.java
```java
package com.gym.service;

import com.gym.entity.Course;
import com.gym.dto.CourseDTO;

import java.util.List;

public interface CourseService {
    // 添加课程
    Course addCourse(CourseDTO courseDTO);
    
    // 根据ID查找课程
    Course findById(Long id);
    
    // 查找所有课程
    List<Course> findAllCourses();
    
    // 查找教练的课程
    List<Course> findByCoachId(Long coachId);
    
    // 更新课程状态
    void updateCourseStatus(Long id, String status);
    
    // 更新课程当前人数
    void updateCurrentCount(Long id, Integer count);
}
```

#### 3.3.3 BookingService.java
```java
package com.gym.service;

import com.gym.entity.Booking;
import com.gym.entity.User;

import java.util.List;

public interface BookingService {
    // 预约课程
    Booking bookCourse(Long userId, Long courseId);
    
    // 取消预约
    void cancelBooking(Long bookingId);
    
    // 查找用户的预约
    List<Booking> findByUserId(Long userId);
    
    // 查找课程的预约
    List<Booking> findByCourseId(Long courseId);
    
    // 查找预约的会员信息
    List<User> findBookingUsersByCourseId(Long courseId);
    
    // 检查用户是否已预约课程
    boolean checkUserBooked(Long userId, Long courseId);
}
```

#### 3.3.4 MembershipCardService.java
```java
package com.gym.service;

import com.gym.entity.MembershipCard;

import java.math.BigDecimal;
import java.util.List;

public interface MembershipCardService {
    // 创建会员卡
    MembershipCard createCard(Long userId, String cardType, BigDecimal price);
    
    // 根据用户ID查找会员卡
    MembershipCard findByUserId(Long userId);
    
    // 更新会员卡状态
    void updateCardStatus(Long id, Integer status);
    
    // 获取所有会员卡类型配置
    List<String> getAllCardTypes();
    
    // 设置会员卡类型和价格
    void setCardTypePrice(String type, BigDecimal price);
    
    // 获取会员卡价格
    BigDecimal getCardTypePrice(String type);
}
```

### 3.4 控制器设计

#### 3.4.1 AuthController.java
```java
package com.gym.controller;

import com.gym.dto.LoginDTO;
import com.gym.entity.User;
import com.gym.service.UserService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;

import javax.servlet.http.HttpSession;

@Controller
@RequestMapping("/")
public class AuthController {
    
    @Autowired
    private UserService userService;
    
    @GetMapping("login")
    public String loginPage() {
        return "auth/login";
    }
    
    @PostMapping("login")
    public String login(LoginDTO loginDTO, Model model, HttpSession session) {
        try {
            User user = userService.login(loginDTO);
            session.setAttribute("user", user);
            
            // 根据用户类型跳转到不同页面
            if ("MEMBER".equals(user.getType())) {
                return "redirect:/member/index";
            } else if ("COACH".equals(user.getType())) {
                return "redirect:/coach/index";
            } else if ("ADMIN".equals(user.getType())) {
                return "redirect:/admin/index";
            }
        } catch (Exception e) {
            model.addAttribute("error", e.getMessage());
            return "auth/login";
        }
        return "auth/login";
    }
    
    @GetMapping("register")
    public String registerPage() {
        return "auth/register";
    }
    
    @PostMapping("register")
    public String register(String phone, String password, String name, Model model) {
        try {
            userService.register(phone, password, name, "MEMBER");
            model.addAttribute("success", "注册成功，请登录");
            return "auth/login";
        } catch (Exception e) {
            model.addAttribute("error", e.getMessage());
            return "auth/register";
        }
    }
    
    @GetMapping("logout")
    public String logout(HttpSession session) {
        session.invalidate();
        return "redirect:/login";
    }
}
```

#### 3.4.2 MemberController.java
```java
package com.gym.controller;

import com.gym.entity.Course;
import com.gym.entity.MembershipCard;
import com.gym.entity.Booking;
import com.gym.entity.User;
import com.gym.service.CourseService;
import com.gym.service.BookingService;
import com.gym.service.MembershipCardService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.*;

import javax.servlet.http.HttpSession;
import java.util.List;

@Controller
@RequestMapping("/member")
public class MemberController {
    
    @Autowired
    private MembershipCardService membershipCardService;
    
    @Autowired
    private CourseService courseService;
    
    @Autowired
    private BookingService bookingService;
    
    @GetMapping("index")
    public String index() {
        return "member/index";
    }
    
    @GetMapping("card")
    public String viewCard(Model model, HttpSession session) {
        User user = (User) session.getAttribute("user");
        MembershipCard card = membershipCardService.findByUserId(user.getId());
        model.addAttribute("card", card);
        return "member/card";
    }
    
    @GetMapping("courses")
    public String viewCourses(Model model, HttpSession session) {
        User user = (User) session.getAttribute("user");
        List<Course> courses = courseService.findAllCourses();
        model.addAttribute("courses", courses);
        model.addAttribute("userId", user.getId());
        return "member/courses";
    }
    
    @PostMapping("courses/book")
    public String bookCourse(@RequestParam Long courseId, HttpSession session, Model model) {
        try {
            User user = (User) session.getAttribute("user");
            bookingService.bookCourse(user.getId(), courseId);
            model.addAttribute("success", "预约成功");
        } catch (Exception e) {
            model.addAttribute("error", e.getMessage());
        }
        return viewCourses(model, session);
    }
    
    @GetMapping("bookings")
    public String viewBookings(Model model, HttpSession session) {
        User user = (User) session.getAttribute("user");
        List<Booking> bookings = bookingService.findByUserId(user.getId());
        model.addAttribute("bookings", bookings);
        return "member/bookings";
    }
    
    @PostMapping("bookings/cancel/{id}")
    public String cancelBooking(@PathVariable Long id, Model model) {
        try {
            bookingService.cancelBooking(id);
            model.addAttribute("success", "取消预约成功");
        } catch (Exception e) {
            model.addAttribute("error", e.getMessage());
        }
        return "redirect:/member/bookings";
    }
}
```

## 4. 数据库设计与实现

### 4.1 数据库建表SQL

#### 4.1.1 用户表（user）
```sql
CREATE TABLE `user` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '用户ID',
  `phone` varchar(20) NOT NULL COMMENT '手机号',
  `password` varchar(100) NOT NULL COMMENT '密码（MD5加密）',
  `type` varchar(10) NOT NULL COMMENT '用户类型（MEMBER/COACH/ADMIN）',
  `name` varchar(50) NOT NULL COMMENT '姓名',
  `status` int(11) DEFAULT '1' COMMENT '状态（1-启用，0-禁用）',
  `create_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_phone` (`phone`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='用户表';
```

#### 4.1.2 会员卡表（membership_card）
```sql
CREATE TABLE `membership_card` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '会员卡ID',
  `user_id` bigint(20) NOT NULL COMMENT '关联用户ID',
  `card_type` varchar(20) NOT NULL COMMENT '卡类型（月卡/季卡/年卡）',
  `price` decimal(10,2) NOT NULL COMMENT '价格',
  `start_date` date NOT NULL COMMENT '开始日期',
  `end_date` date NOT NULL COMMENT '结束日期',
  `status` int(11) DEFAULT '1' COMMENT '状态（1-有效，0-过期）',
  PRIMARY KEY (`id`),
  KEY `idx_user_id` (`user_id`),
  CONSTRAINT `fk_user_id` FOREIGN KEY (`user_id`) REFERENCES `user` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='会员卡表';
```

#### 4.1.3 课程表（course）
```sql
CREATE TABLE `course` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '课程ID',
  `name` varchar(100) NOT NULL COMMENT '课程名称',
  `coach_id` bigint(20) NOT NULL COMMENT '关联教练ID',
  `course_time` datetime NOT NULL COMMENT '课程时间',
  `max_count` int(11) NOT NULL COMMENT '人数上限',
  `current_count` int(11) DEFAULT '0' COMMENT '当前预约人数',
  `status` varchar(20) DEFAULT 'NOT_STARTED' COMMENT '状态（未开始/进行中/已结束）',
  PRIMARY KEY (`id`),
  KEY `idx_coach_id` (`coach_id`),
  CONSTRAINT `fk_coach_id` FOREIGN KEY (`coach_id`) REFERENCES `user` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='课程表';
```

#### 4.1.4 预约表（booking）
```sql
CREATE TABLE `booking` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '预约ID',
  `user_id` bigint(20) NOT NULL COMMENT '会员ID',
  `course_id` bigint(20) NOT NULL COMMENT '课程ID',
  `booking_time` datetime DEFAULT CURRENT_TIMESTAMP COMMENT '预约时间',
  `status` varchar(20) DEFAULT 'BOOKED' COMMENT '状态（已预约/已取消）',
  PRIMARY KEY (`id`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_course_id` (`course_id`),
  CONSTRAINT `fk_booking_user_id` FOREIGN KEY (`user_id`) REFERENCES `user` (`id`),
  CONSTRAINT `fk_booking_course_id` FOREIGN KEY (`course_id`) REFERENCES `course` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='预约表';
```

#### 4.1.5 会员卡类型配置表（card_type_config）
```sql
CREATE TABLE `card_type_config` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT '配置ID',
  `type` varchar(20) NOT NULL COMMENT '卡类型',
  `price` decimal(10,2) NOT NULL COMMENT '价格',
  `duration_days` int(11) NOT NULL COMMENT '有效期天数',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_type` (`type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='会员卡类型配置表';
```

### 4.2 MyBatis映射文件示例

#### 4.2.1 UserMapper.xml
```xml
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gym.mapper.UserMapper">
    
    <insert id="insert" parameterType="com.gym.entity.User">
        INSERT INTO user (phone, password, type, name, status, create_time)
        VALUES (#{phone}, #{password}, #{type}, #{name}, #{status}, #{createTime})
    </insert>
    
    <select id="selectByPhone" parameterType="String" resultType="com.gym.entity.User">
        SELECT * FROM user WHERE phone = #{phone}
    </select>
    
    <select id="selectById" parameterType="Long" resultType="com.gym.entity.User">
        SELECT * FROM user WHERE id = #{id}
    </select>
    
    <update id="updateStatus" parameterType="map">
        UPDATE user SET status = #{status} WHERE id = #{id}
    </update>
    
    <select id="selectMembers" parameterType="String" resultType="com.gym.entity.User">
        SELECT * FROM user 
        WHERE type = 'MEMBER'
        <if test="keyword != null and keyword != ''">
            AND (name LIKE CONCAT('%', #{keyword}, '%') OR phone LIKE CONCAT('%', #{keyword}, '%'))
        </if>
    </select>
    
    <select id="selectCoaches" resultType="com.gym.entity.User">
        SELECT * FROM user WHERE type = 'COACH'
    </select>
    
    <delete id="deleteById" parameterType="Long">
        DELETE FROM user WHERE id = #{id}
    </delete>
</mapper>
```

## 5. 前端页面设计

### 5.1 登录页面（login.html）
```html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>登录 - 健身房管理系统</title>
    <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
    <div class="container login-container">
        <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="card login-card">
                    <div class="card-header text-center">
                        <h3>健身房管理系统登录</h3>
                    </div>
                    <div class="card-body">
                        <form th:action="@{/login}" method="post">
                            <div class="form-group">
                                <label for="phone">手机号</label>
                                <input type="tel" class="form-control" id="phone" name="phone" required>
                            </div>
                            <div class="form-group">
                                <label for="password">密码</label>
                                <input type="password" class="form-control" id="password" name="password" required>
                            </div>
                            <button type="submit" class="btn btn-primary btn-block">登录</button>
                            <div class="text-center mt-3">
                                <a th:href="@{/register}">还没有账号？立即注册</a>
                            </div>
                        </form>
                        <div class="alert alert-danger mt-3" th:if="${error}" th:text="${error}"></div>
                        <div class="alert alert-success mt-3" th:if="${success}" th:text="${success}"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdn.bootcss.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
</body>
</html>
```

### 5.2 会员中心页面（member/index.html）
```html
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>会员中心 - 健身房管理系统</title>
    <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
    <div th:replace="common/header :: header"></div>
    
    <div class="container mt-4">
        <div class="row">
            <div class="col-md-3">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title" th:text="'欢迎，' + ${session.user.name}"></h5>
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item"><a th:href="@{/member/index}">个人中心</a></li>
                            <li class="list-group-item"><a th:href="@{/member/card}">会员卡信息</a></li>
                            <li class="list-group-item"><a th:href="@{/member/courses}">课程预约</a></li>
                            <li class="list-group-item"><a th:href="@{/member/bookings}">我的预约</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="col-md-9">
                <div class="card">
                    <div class="card-header">
                        <h3>个人信息</h3>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <p><strong>姓名：</strong><span th:text="${session.user.name}"></span></p>
                                <p><strong>手机号：</strong><span th:text="${session.user.phone}"></span></p>
                                <p><strong>注册时间：</strong><span th:text="${#dates.format(session.user.createTime, 'yyyy-MM-dd HH:mm:ss')}"></span></p>
                            </div>
                            <div class="col-md-6">
                                <div class="alert alert-info">
                                    <h5>温馨提示</h5>
                                    <p>1. 请保持会员卡有效，过期后将无法预约课程</p>
                                    <p>2. 预约课程后如需取消，请提前2小时操作</p>
                                    <p>3. 如有任何问题，请联系前台客服</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div th:replace="common/footer :: footer"></div>
    
    <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdn.bootcss.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
</body>
</html>
```

## 6. 工具类设计

### 6.1 MD5Util.java
```java
package com.gym.util;

import java.security.MessageDigest;
import java.security.NoSuchAlgorithmException;

public class MD5Util {
    
    public static String encrypt(String password) {
        try {
            MessageDigest md = MessageDigest.getInstance("MD5");
            byte[] bytes = md.digest(password.getBytes());
            StringBuilder sb = new StringBuilder();
            for (byte b : bytes) {
                String hex = Integer.toHexString(b & 0xFF);
                if (hex.length() == 1) {
                    sb.append('0');
                }
                sb.append(hex);
            }
            return sb.toString();
        } catch (NoSuchAlgorithmException e) {
            throw new RuntimeException(e);
        }
    }
    
    public static boolean verify(String password, String encryptedPassword) {
        return encrypt(password).equals(encryptedPassword);
    }
}
```

### 6.2 DateUtil.java
```java
package com.gym.util;

import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.Calendar;
import java.util.Date;

public class DateUtil {
    
    public static final String DATE_FORMAT = "yyyy-MM-dd";
    public static final String DATETIME_FORMAT = "yyyy-MM-dd HH:mm:ss";
    
    public static String formatDate(Date date) {
        return formatDate(date, DATE_FORMAT);
    }
    
    public static String formatDateTime(Date date) {
        return formatDate(date, DATETIME_FORMAT);
    }
    
    public static String formatDate(Date date, String pattern) {
        if (date == null) {
            return null;
        }
        SimpleDateFormat sdf = new SimpleDateFormat(pattern);
        return sdf.format(date);
    }
    
    public static Date parseDate(String dateStr) throws ParseException {
        return parseDate(dateStr, DATE_FORMAT);
    }
    
    public static Date parseDateTime(String dateTimeStr) throws ParseException {
        return parseDate(dateTimeStr, DATETIME_FORMAT);
    }
    
    public static Date parseDate(String dateStr, String pattern) throws ParseException {
        SimpleDateFormat sdf = new SimpleDateFormat(pattern);
        return sdf.parse(dateStr);
    }
    
    public static Date addDays(Date date, int days) {
        Calendar calendar = Calendar.getInstance();
        calendar.setTime(date);
        calendar.add(Calendar.DAY_OF_MONTH, days);
        return calendar.getTime();
    }
    
    public static int getDaysBetween(Date startDate, Date endDate) {
        Calendar start = Calendar.getInstance();
        start.setTime(startDate);
        Calendar end = Calendar.getInstance();
        end.setTime(endDate);
        
        long startTime = start.getTimeInMillis();
        long endTime = end.getTimeInMillis();
        
        return (int) ((endTime - startTime) / (1000 * 60 * 60 * 24));
    }
    
    public static boolean isExpired(Date endDate) {
        return endDate.before(new Date());
    }
}
```

## 7. 安全配置

### 7.1 SecurityConfig.java
```java
package com.gym.config;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;
import org.springframework.security.core.userdetails.UserDetailsService;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.security.crypto.password.PasswordEncoder;

@Configuration
@EnableWebSecurity
public class SecurityConfig extends WebSecurityConfigurerAdapter {
    
    @Autowired
    private UserDetailsService userDetailsService;
    
    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http
            .authorizeRequests()
                .antMatchers("/", "/login", "/register", "/css/**", "/js/**", "/images/**").permitAll()
                .antMatchers("/member/**").hasRole("MEMBER")
                .antMatchers("/coach/**").hasRole("COACH")
                .antMatchers("/admin/**").hasRole("ADMIN")
                .anyRequest().authenticated()
            .and()
            .formLogin()
                .loginPage("/login")
                .usernameParameter("phone")
                .passwordParameter("password")
                .defaultSuccessUrl("/index")
                .permitAll()
            .and()
            .logout()
                .logoutUrl("/logout")
                .logoutSuccessUrl("/login")
                .permitAll()
            .and()
            .csrf().disable();
    }
    
    @Override
    protected void configure(AuthenticationManagerBuilder auth) throws Exception {
        auth.userDetailsService(userDetailsService).passwordEncoder(passwordEncoder());
    }
    
    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }
}
```

## 8. 应用配置文件

### 8.1 application.properties
```properties
# 数据库配置
spring.datasource.url=jdbc:mysql://localhost:3306/gym_management?useUnicode=true&characterEncoding=utf-8&useSSL=false&serverTimezone=UTC
spring.datasource.username=root
spring.datasource.password=root
spring.datasource.driver-class-name=com.mysql.jdbc.Driver

# MyBatis配置
mybatis.mapper-locations=classpath:mapper/*.xml
mybatis.type-aliases-package=com.gym.entity

# Thymeleaf配置
spring.thymeleaf.cache=false
spring.thymeleaf.prefix=classpath:/templates/
spring.thymeleaf.suffix=.html
spring.thymeleaf.encoding=UTF-8
spring.thymeleaf.mode=HTML5

# 日志配置
logging.level.root=INFO
logging.level.com.gym=DEBUG

# 服务器配置
server.port=8080
server.servlet.context-path=/gym
```

## 9. 部署和运行说明

### 9.1 环境准备
1. JDK 1.8.0_152
2. Maven 3.9.11
3. MySQL 5.7.32

### 9.2 数据库初始化
1. 创建数据库 `gym_management`
2. 执行数据库建表SQL脚本
3. 插入初始数据（管理员账号等）

### 9.3 项目构建
```bash
mvn clean package
```

### 9.4 启动服务
```bash
java -jar target/gym-management-system-1.0.0.jar
```

### 9.5 访问系统
- 系统地址：http://localhost:8080/gym
- 管理员账号：admin/123456
- 测试账号可通过注册功能创建

## 10. 总结

本文档详细描述了健身房管理系统的实现设计，包括项目结构、类设计、数据库设计、前端页面设计等内容。系统采用SpringBoot框架，实现了会员、教练和管理员三个主要角色的功能需求。文档提供了详细的代码示例和配置说明，可以作为开发人员实现系统的具体指导。